
	<link href="//dev.hardcover.me/mobile_files/photoswipe.css" type="text/css" rel="stylesheet" />
    <link href="//dev.hardcover.me/js/jquery-ui.css" rel="stylesheet" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="/mobile_files/css/blueimp-gallery.min.css">
    <link rel="stylesheet" href="/mobile_files/css/jquery.fileupload.css">
    <link rel="stylesheet" href="/mobile_files/css/jquery.fileupload-ui.css">
    <!-- CSS adjustments for browsers with JavaScript disabled -->
    <noscript><link rel="stylesheet" href="/mobile_files/css/jquery.fileupload-noscript.css"></noscript>
    <noscript><link rel="stylesheet" href="/mobile_files/css/jquery.fileupload-ui-noscript.css"></noscript>
    <!-- Shim to make HTML5 elements usable in older Internet Explorer versions -->
    <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

<style type="text/css">
div.gallery-row:after {
	clear:both;
	content:".";
	display:block;
	height:0;
	visibility:hidden;
}
	div.gallery-item {
	float:left;
	width:33.333333%;
}
	div.gallery-item a {
	display:block;
	margin:5px;
	border:1px solid #3c3c3c;
}
	div.gallery-item img {
	display:block;
	width:100%;
	height:auto;
}
	#Gallery1 .ui-content,#Gallery2 .ui-content {
	overflow:hidden;
}
.plupload_container {
	min-height:100px;
}
#uploader_dropbox {
	display:none;
}
#uploader_buttons div {
	margin:0;
	padding:5px;
}
.plupload_filelist_footer {
	height:100%;
}
#addFromPhone {
	max-width:700px;
}
#form_filter_data {
	display: none;
}
.file-upload {
    position: relative;
}
.file-upload input {
    position: absolute;
    visibility: hidden;
    top: 0;
    left: 0;
}
</style>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<script type="text/javascript" src="//code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script>
    <script type="text/javascript" src="//dev.hardcover.me/js/libs/head.min.js"></script>
    <script type="text/javascript" src="//dev.hardcover.me/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="//dev.hardcover.me/mobile_files/simple-inheritance.min.js"></script>
	<script type="text/javascript" src="//dev.hardcover.me/mobile_files/jquery.animate-enhanced.min.js"></script>
	<script type="text/javascript" src="//dev.hardcover.me/mobile_files/jquery.photoswipe.1.0.11.mod.js"></script>
 <script type="text/javascript">
$(document).ready(function () {
      var thisURL = '//dev.hardcover.me/books/joshua.lua/new_book_01';
    var thisBookName = 'New Book 01';
    var thisOwner = 'Joshua Lua';
    var thisBookDesc = 'this book was creater after new save image script';
    var bc = "";
    var fc = "1566435818_1170_front.jpg";
    var fc_date = "";
    var book_pages = [{"fb_dataid":"","image_url":"o_18f42l2utn671efi1svgu9812sce.jpg","message":null,"book_pages_id":"38960","created_date":"2014,01,25","fb_username":null},{"fb_dataid":"","image_url":"o_18f42l5ul1map10uh9eb1gtb1olki.jpg","message":null,"book_pages_id":"38961","created_date":"2014,01,25","fb_username":null},{"fb_dataid":"","image_url":"o_18f42l8ia2ii1djuofu3c11km.jpg","message":null,"book_pages_id":"38962","created_date":"2014,01,25","fb_username":null},{"fb_dataid":"","image_url":"o_18f42lbbh1j2vkcsq8o146pbk6q.jpg","message":null,"book_pages_id":"38963","created_date":"2014,01,25","fb_username":null}] ;
    var data_len = 4 ;
    var author_name = "";
    var fbScopePerm = '';
    var bs_id = "";
    var ask_see_ids = "";
    //need to update this for static image sizes
    var wW = $(document).width();
    var wH = $(document).height();
    if (wW >= 1920) {
        var bgWidth = 1920;
        var bgHeight = 1440;
        var smWidth = 640;
        var smHeight = 480;
    }
    if (wW < 1920) {
        var bgWidth = 1680;
        var bgHeight = 1050;
        var smWidth = 480;
        var smHeight = 320;
    }
    if (wW < 1680) {
        var bgWidth = 1440;
        var bgHeight = 900;
        var smWidth = 320;
        var smHeight = 240;
    }
    if (wW < 1440) {
        var bgWidth = 1366;
        var bgHeight = 768;
        var smWidth = 150;
        var smHeight = 150;
    }
    if (wW < 1366) {
        var bgWidth = 1280;
        var bgHeight = 1024;
        var smWidth = 150;
        var smHeight = 150;
    }
    if (wW < 1280) {
        var bgWidth = 1024;
        var bgHeight = 768;
        var smWidth = 150;
        var smHeight = 150;
    }
    if (wW < 1024) {
        var bgWidth = 640;
        var bgHeight = 480;
        var smWidth = 150;
        var smHeight = 150;
    }
    if (wW < 640) {
        var bgWidth = 480;
        var bgHeight = 320;
        var smWidth = 150;
        var smHeight = 150;
    }
    if (wW < 480) {
        var bgWidth = 320;
        var bgHeight = 240;
        var smWidth = 150;
        var smHeight = 150;
    }

//    function fileExists(url){
//        var http = new XMLHttpRequest();
//        http.open('HEAD', url, false);
//        http.send();
//        console.log(http.status);
//        return http.status!=404;
//    }
    function createBook() {
        var thisPage = "";
        var rowCount = 0;
        for (var i = 0; i <= data_len; i++) {
            var sourceImage = "";
            if (rowCount == 0)
                thisPage += '<div class="gallery-row">';
            if (i == 0 && fc) {
                sourceImage = fc;
            } else if (i == data_len && bc) {
                sourceImage = bc;
            } else {
                sourceImage = book_pages[i - 1].image_url;
            }
            if (sourceImage) {
                fullImage = "//images.hardcover.me/uploads/" + bgWidth + "x" + bgHeight + "/" + sourceImage;
                thumbImage = "//images.hardcover.me/uploads/" + smWidth + "x" + smHeight + "/" + sourceImage;
                thisPage += '<div class="gallery-item"><a href="' + fullImage + '" rel="external" id="imgToClick' + i + '"><img src="' + thumbImage + '" alt="Image ' + i + '" /></a></div>';
                if (rowCount == 2) {
                    thisPage += '</div>';
                    rowCount = 0;
                } else {
                    rowCount++;
                }
            }
        }
        $(".gallery").html(thisPage);
        $('div.gallery-page').on('pageshow', function (e) {
            $("div.gallery a", e.target).photoSwipe({
                                  btnAddPhoto: true,
                                    doThis: true
            });
            return true;
        });
        var doNotLoad = 0;
        if(doNotLoad == 0){
            doNotLoad = 1;
            setTimeout(function () {
                console.log("wait fired");
                $("#imgToClick0").click();
            }, 1000);
        }
        $("#clickToLoad").click();
    }
    /*
			This example shows how to set up PhotoSwipe using jQuery Mobile.
		*/


    createBook();
    $("#popAddFromPhone").on("click", function () {
        console.log("cam button clicked");
        $("#addPhotoPop").popup("close");
        setTimeout(function () {
            $("#addFromPhone").popup("open");
        }, 1000);
    });
    });

	</script>
<!--Content for the Filter Page-->
<form id="fileupload" action="/" method="POST" enctype="multipart/form-data">
    <div id="filter_content">
        <div>
            <div class='panel-container'>
                <div id="tabs1-computer">
                        <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
                        <div class="row fileupload-buttonbar">
                            <div class="col-lg-7">
                                <!-- The fileinput-button span is used to style the file input field as button -->
                                <span class="btn btn-success fileinput-button">
                <i class="glyphicon glyphicon-plus">
                </i>
                <span>
                  Take Picture...
                </span>
                                <input type="file" accept="image/*;capture=camera" name="files[]" />

                                </span>
                                <button type="submit" class="btn btn-primary start">
                                    <i class="glyphicon glyphicon-upload">
                </i>
                                    <span>
                  Start upload
                </span>
                                </button>
                                <button type="reset" class="btn btn-warning cancel">
                                    <i class="glyphicon glyphicon-ban-circle">
                </i>
                                    <span>
                  Cancel upload
                </span>
                                </button>
                                <button type="button" class="btn btn-danger delete">
                                    <i class="glyphicon glyphicon-trash">
                </i>
                                    <span>
                  Delete
                </span>
                                </button>
                                <input type="checkbox" class="toggle">
                                <!-- The global file processing state -->
                                <span class="fileupload-process">
              </span>
                            </div>
                            <!-- The global progress state -->
                            <div class="col-lg-5 fileupload-progress fade">
                                <!-- The global progress bar -->
                                <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                    <div class="progress-bar progress-bar-success" style="width:0%;">
                                    </div>
                                </div>
                                <!-- The extended global progress state -->
                                <div class="progress-extended">
                                    &nbsp;
                                </div>
                            </div>
                        </div>
                        <!-- The table listing the files available for upload/download -->
                        <table role="presentation" class="table table-striped">
                            <tbody class="files">
                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
            <div id="button_edit_right" class="text-right clearfix popup">
                <input id="filter_next_unique" type="button" class="btn btn-orange margin-right-sm filter_next_pro ui-btn-inline" data-mini="true" value="Next" name="submit" />
                <input id="filter_close" onclick="hideoverlay()" type="button" class="btn btn-orange ui-btn-inline" data-mini="true" value="Close" name="submit" />

            </div>
        </div>
        <!-- End of #tabs-->
    </div>
</form>


<link rel="stylesheet" type="text/css" href="/css/skins/tango/skin.css" />
<script id="template-upload" type="text/x-tmpl">
{% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-upload fade">
        <td>
            <span class="preview"></span>
        </td>
        <td>
            <p class="name">{%=file.name%}</p>
            <strong class="error text-danger"></strong>
        </td>
        <td>
            <p class="size">Processing...</p>
            <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-success" style="width:0%;"></div></div>
        </td>
        <td>
            {% if (!i && !o.options.autoUpload) { %}
                <button class="btn btn-primary start" disabled>
                    <i class="glyphicon glyphicon-upload"></i>
                    <span>Start</span>
                </button>
            {% } %}
            {% if (!i) { %}
                <button class="btn btn-warning cancel">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                    <span>Cancel</span>
                </button>
            {% } %}
        </td>
    </tr>
{% } %}
</script>
<!-- The template to display files available for download -->
<script id="template-download" type="text/x-tmpl">
{% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-download fade">
        <td>
            <span class="preview">
                {% if (file.thumbnailUrl) { %}
                    <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" data-gallery><img src="{%=file.thumbnailUrl%}"></a>
                {% } %}
            </span>
        </td>
        <td>
            <p class="name">
                {% if (file.url) { %}
                    <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" {%=file.thumbnailUrl?'data-gallery':''%}>{%=file.name%}</a>
                {% } else { %}
                    <span>{%=file.name%}</span>
                {% } %}
            </p>
            {% if (file.error) { %}
                <div><span class="label label-danger">Error</span> {%=file.error%}</div>
            {% } %}
        </td>
        <td>
            <span class="size">{%=o.formatFileSize(file.size)%}</span>
        </td>
        <td>
            {% if (file.deleteUrl) { %}
                <button class="btn btn-danger delete" data-type="{%=file.deleteType%}" data-url="{%=file.deleteUrl%}"{% if (file.deleteWithCredentials) { %} data-xhr-fields='{"withCredentials":true}'{% } %}>
                    <i class="glyphicon glyphicon-trash"></i>
                    <span>Delete</span>
                </button>
                <input type="checkbox" name="delete" value="1" class="toggle">
            {% } else { %}
                <button class="btn btn-warning cancel">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                    <span>Cancel</span>
                </button>
            {% } %}
        </td>
    </tr>
{% } %}
</script>

<script type="text/javascript">
head.js(
    '//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js',
    //'/mobile_files/js/vendor/jquery.ui.widget.js',
    '/mobile_files/js/tmpl.min.js',
    '/mobile_files/js/load-image.min.js',
    '/mobile_files/js/canvas-to-blob.min.js',
    '/mobile_files/js/jquery.blueimp-gallery.min.js',
    '/mobile_files/js/jquery.iframe-transport.js',
    '/mobile_files/js/jquery.fileupload.js',
    '/mobile_files/js/jquery.fileupload-process.js',
    '/mobile_files/js/jquery.fileupload-image.js',
    '/mobile_files/js/jquery.fileupload-audio.js',
    '/mobile_files/js/jquery.fileupload-video.js',
    '/mobile_files/js/jquery.fileupload-validate.js',
    '/mobile_files/js/jquery.fileupload-ui.js',
    '/mobile_files/js/main.js'
);

head.ready(function () {
    var wW = $(window).width();
    var wH = $(window).height();
    var book_id = $("body").attr("book_info_id");
    $("#addFromPhone-popup").css({
        "top": "0",
        "left": "0",
        //"width": wW + "px",
        //"height": wH + "px"
    });
    $("#book_input_id").val(book_id);
    $("#fileupload").show();

    $('#filter_next_unique').unbind("click").on('click', function () {
        console.log("next clicked");
        var book_id = $("body").attr("book_info_id");
        $("#fileupload #book_info_id").val(book_id);
        console.log("click book id: " + $("#fileupload #book_info_id").val());
        $(this).append('<div class="ajax_loader"></div>');
        var form_data = $('#fileupload').serialize();
        var ulink = '/filter/save_book_filter_cover_unique';

        $.ajax({
            cache: false,
            url: ulink,
            type: 'post',
            data: form_data,
            success: function (res) {
                $('.ajax_loader').remove();
                var _obj = $.parseJSON(res);

                if (_obj.status != 0) {
                    alert(_obj.msg);
                } else {
                    console.log('in else');
                    /*$('#main_inner_uploder_pop').html('');
								$('#main_inner_uploder_pop').css('display','none');
                                $('#main_inner').html(_obj.data);
                                $('#fb_data').fadeIn(); //Fade in the active ID content
                                $.ajax({
                                    cache   : false,
                                    url     : '../../../filter/createBookCover',
                                    type    : 'post',
                                    data    : { 'book_info_id' : $.cookie('hardcover_book_info_id') },
                                    success : function(res){}
                                });*/
                    //   var pathname = window.location.pathname;
                    //window.location.href = pathname;
                    $('#main_inner_uploder_pop').html('').remove();
                    $('#main_inner_overlay').css('display', 'none');
                    var link = '/main/get_last_insert_images';
                    $.ajax({
                        cache: false,
                        url: link,
                        type: 'post',
                        success: function (res) {
                            var _obj = $.parseJSON(res);

                            $('#last_inset_div ul#cvv_data').html(_obj.data);
                            $('#last_inset_div_a').click();
                            jQuery('#app_loader23').fadeOut(100);
                            window.location = window.location.pathname;
                        }
                    });
                };
            },
            error: function () {}
        });
        return false;
    });
    // Client side form validation
    $('form').submit(function (e) {
        var uploader = $('#uploader').plupload('getUploader');

        // Files in queue upload them first
        if (uploader.files.length > 0) {
            // When all files are uploaded submit form
            uploader.bind('StateChanged', function () {
                if (uploader.files.length === (uploader.total.uploaded + uploader.total.failed)) {
                    $('form')[0].submit();
                }
            });
            $('#filter_next_unique').css('background', '#b3b3b3');
            uploader.start();
            $('#filter_next_unique').css('background', '#FF9839');
        } else
            alert('You must at least upload one file.');

        return false;
    });
});
</script>
<!-- The XDomainRequest Transport is included for cross-domain file deletion for IE 8 and IE 9 -->
<!--[if (gte IE 8)&(lt IE 10)]>
<script src="js/cors/jquery.xdr-transport.js"></script>
<![endif]-->
<script type="text/javascript">
function hideoverlay(){
	jQuery("#addFromPhone-popup").css('display','none');
	jQuery("#fileupload").fadeOut(100);
}

function get_album_photos(alb_id) {
    if ($("#id_" + alb_id).is(":checked")) {

        $.ajax({
            url: "../../../main/get_album_photos",
            type: "post",
            data: 'alb_id=' + alb_id,
            success: function (res) {
                if (res != '') {
                    $('#album_photo_raw_data').append(res);
                } else {}
            }
        });
    } else {
        $(".cla_" + alb_id).remove();
    }
}
</script>