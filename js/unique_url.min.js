function resizeWindow(e){var t=$(window).width();var n=$(window).height();if(t<book_sizes[0][3]){book_width=book_sizes[0][0];book_height=book_sizes[0][1];font_size=book_font_size*book_sizes[0][2]}else if(t>=book_sizes[0][3]&&t<book_sizes[1][3]){book_width=book_sizes[0][0];book_height=book_sizes[0][1];font_size=book_font_size*book_sizes[0][2]}else if(t>book_sizes[1][3]&&t<book_sizes[2][3]){book_width=book_sizes[1][0];book_height=book_sizes[1][1];font_size=book_font_size*book_sizes[1][2]}else if(t>book_sizes[2][3]&&t<book_sizes[3][3]){book_width=book_sizes[2][0];book_height=book_sizes[2][1];font_size=book_font_size*book_sizes[2][2]}else if(t>book_sizes[3][3]){book_width=book_sizes[3][0];book_height=book_sizes[3][1];font_size=book_font_size*book_sizes[3][2]}font_size=Math.round(font_size);book_preview[0]=t-preview_margin;book_preview[1]=n-preview_margin;book_preview[2]=book_font_size*book_sizes[0][2]}function connectImage(){$(".image_rollover_top").unbind("hover").conRollover("top");$(".image_rollover_right").unbind("hover").conRollover("right");$(".image_rollover_bottom").unbind("hover").conRollover("bottom");$(".image_rollover_left").unbind("hover").conRollover("left")}function checkBox(){function e(){if($(this).hasClass("checked")){$("input[type=checkbox]").attr("value",0);$(this).removeClass("checked");$(this).children().attr("checked",false)}else{$("input[type=checkbox]").attr("value",1);$(this).addClass("checked");$(this).children().attr("checked",true)}}function t(){$(this).addClass("clicked")}function n(){$(this).removeClass("clicked")}$("input[type=checkbox]").each(function(r,i){if($(this).is(":checked")){var s=$('<span class="checked '+$(this).attr("type")+" "+$(this).attr("class")+'"></span>').click(e).mousedown(t).mouseup(n)}else{var s=$('<span class="'+$(this).attr("type")+" "+$(this).attr("class")+'"></span>').click(e).mousedown(t).mouseup(n)}$(this).wrap(s).hide()})}function radioStyle(){function e(){var e=$(this).attr("id");var t=$(this).attr("rel");$("span.radio").each(function(n){if(t==$(this).attr("rel")){if(e==$(this).attr("id")){$("span#"+e).addClass("checked");$(this).children().prop("checked",true)}else{$(this).removeClass("checked");$(this).children().prop("checked",false)}}})}function t(){$(this).addClass("clicked")}function n(){$(this).removeClass("clicked")}$("input[type=radio]").each(function(r,i){if($(this).is(":checked")){var s=$('<span rel="'+$(this).attr("name")+'" id="radio_'+r+'" class="'+$(this).attr("type")+" "+$(this).attr("class")+' checked"></span>').click(e).mousedown(t).mouseup(n);$("#radio_"+r).addClass("checked")}else{var s=$('<span rel="'+$(this).attr("name")+'" id="radio_'+r+'" class="'+$(this).attr("type")+" "+$(this).attr("class")+'"></span>').click(e).mousedown(t).mouseup(n)}$(this).wrap(s).hide()})}function inline(){$(".modal").clone(true).appendTo("#modal_inner");modal_position()}function deletePages(){modal_position()}function sendMessage(){$.ajax({url:"main/fb_message",data:{ret:"send"},type:"post",success:function(e){var t=$.parseJSON(e);$("#modal_inner").append(t.data).fadeIn("slow");modal_position();var n=$("#modal_inner").width()/2;var r=$("#msg_container").width()/2;var i=n-r;var s;var o="";o+="Hi username,\n\n\n";o+="I'm printing a photo album using images and wall post from my FB timeline.\n\n";o+="I would like to add your content to my album as well, so my album will have the perspective from you and me.\n\n\n";o+="Thanks a lot,\n\n\n";o+="You";$("#txtmsg").val(o);$("#f_name").keypress(function(e){if(e.which==13){$.ajax({url:"main/get_fb_names",type:"post",data:{" first_name":$("#f_name").val()},success:function(e){var t=$.parseJSON(e);if(t.status==0){var n=t.data.split(";");$("#sel_friends").empty();$.each(n,function(e,t){var n=t.split(":");var r="https://graph.facebook.com/"+n[0]+"/picture";$("#sel_friends").append('<li id="'+n[0]+'"><img src="'+r+'" width="20">'+n[1]+'<input type="checkbox" id="'+n[0]+'" class="float_right"/></li>');$("#sel_friends").fadeIn("slow")});var r;$.cookie("_friendid",null);$("ul#sel_friends li").each(function(){$(this).live("click",function(){var e=$(this).attr("id");console.log(e);s=$(this).text();$("#f_name").val($(this).text());$.cookie("_friendid",$(this).attr("id"));$('input[type="checkbox"]#'+e).toggle(function(e){$(this).attr("checked","true");e.preventDefault()},function(e){$(this).attr("checked","false");e.preventDefault()});var t;FB.api($.cookie("hardcover_fbid"),function(e){t=e.name;console.log(e.name);var n="";n+="Hi "+s+",\n\n\n";n+="I'm printing a photo album using images and wall post from my FB timeline.\n\n";n+="I would like to add your content to my album as well, so my album will have the perspective from you and me.\n\n\n";n+="Thanks a lot,\n\n\n";n+=e.name;$("#txtmsg").val(n)})}).animate({opacity:1}).hover(function(){$(this).animate({opacity:.8})},function(){$(this).animate({opacity:1})})});$("ul#sel_friends").mouseleave(function(e){$("#sel_friends").fadeOut("slow")})}}});e.preventDefault()}}).focus(function(){$("#sel_friends").fadeOut("slow")}).click(function(){$("#sel_friends").fadeOut("slow")});$("#msg_container").css({opacity:1,"margin-left":i});$("#submit_form").click(function(e){var t=$.trim($.cookie("_friendid"));$("#sel_friends").fadeOut("slow");post_to_timeline(t);$.ajax({url:"main/friends_being_requested_for_fbdata",type:"post",data:{friends_fbid:t},sucess:function(){},error:function(){}});e.preventDefault()});$("#cancel_form").live("click",function(){$("#modal_bckgrnd,#modal_container").animate({opacity:0},"slow","linear",function(){$(this).remove()});$("#sel_friends").fadeOut("slow");return false})}})}function friendSelector(){$.ajax({url:"main/fb_message",data:{ret:"friends"},type:"post",success:function(e){var t=$.parseJSON(e);$("#modal_inner").append(t.data);modal_position();var n=$("#modal_inner").width()/2;var r=$("#msg_container_bottom").width()/2;var i=n-r;$("#msg_container_bottom").css({opacity:1,"margin-left":i})}})}function post_to_timeline(e){var t=$.cookie("hardcover_book_info_id");var n=$.cookie("hardcover_token");checkPermissions();var r=$("#txtmsg").val();FB.api(e+"/feed?access_token="+n,"post",{message:$("#txtmsg").val(),url:"hardcover.me",link:"http://dev.hardcover.me/main/share_url?book_info_id="+t+"&rated="+e,picture:"https://dev.hardcover.me/images/slide2/HardCover_logo.png"},function(e){console.log(e);$("#modal_bckgrnd,#modal_container").animate({opacity:0},"slow","linear",function(){$(this).remove()})})}function checkPermissions(){FB.api("me/permissions",function(e){var t=["user_photos","friends_photos","read_stream","publish_stream","publish_actions"];$.each(t,function(t,n){if(!e||!e.data[0]||!(n in e.data[0])){logIn()}})})}function logIn(){FB.login(function(e){if(e.authResponse){var t=$("#fname").val();post_to_timeline(t)}},{scope:"user_photos,friends_photos,read_stream,publish_stream,publish_actions"})}function modal_position(){var e=$("#modal_container").height()/2;var t=$("#modal_inner").height()/2;var n=e-t;$("#modal_inner").css({opacity:1,"margin-top":n}).fadeIn()}function printBook(){$.ajax({url:"album/fb_message",data:{ret:"print"},type:"post",success:function(e){var t=$.parseJSON(e);$("#modal_inner").append(t.data).fadeIn("slow");modal_position();var n=$("#modal_inner").width()/2;var r=$("#msg_container_bottom").width()/2;var i=n-r;$("#msg_container").css({opacity:1,"margin-left":i})}})}function myPageflip(e,t){function P(e){y.x=e.clientX-w.offsetLeft-i/2;y.y=e.clientY-w.offsetTop}function H(e){var t=e.srcElement?e.srcElement:e.target;if(t.tagName=="IMG"||t.tagName=="A"||t.tagName=="INPUT"||t.type=="BUTTON"||t.type=="SELECT"||t.tagName=="TEXTAREA"||t.tagName=="SELECT"){return false}else{if(Math.abs(y.x)<o){if(y.x<0&&c-1>=0){b[c-1].dragging=true;d=c-1;$.cookie("selPage",null);$.cookie("selPage",d);$("section._left").each(function(t,n){if(e.type=="mousedown"){if($(n).width()>156&&$(n).position().left<335){var r=parseInt($(n).css("z-index"));if(r<99){r=parseInt(r)+100;$(n).css({"z-index":r})}}}})}else if(y.x>0&&c+1<b.length){b[c].dragging=true;d=c;$.cookie("selPage",null);$.cookie("selPage",d);if(e.type=="mousedown"){$("section._left").each(function(e,t){if($(t).width()>320&&$(t).position().left<12){var n=$(t).css("z-index");if(n>99){n=parseInt(n)-100;$(t).css({"z-index":n})}}})}}if(b[d].dragging){m.style.zIndex=100}}}e.preventDefault()}function B(e){for(var t=0;t<b.length;t++){if(b[t].dragging){if(y.x<0){p=t;b[t].target=-1;if(d==c){c=Math.min(c+1,b.length);$("#pagination ul li.current").removeClass("current");var n=$(b[t+1].page).attr("id");$("li#"+n).addClass("current").prev().addClass("current")}}else{p=t;b[t].target=1;if(d!=c){c=Math.max(c-1,0);$("#pagination ul li.current").removeClass("current");var n=$(b[t].page).attr("id");$("li#"+n).addClass("current").prev().addClass("current")}}}b[t].dragging=false;if(b[t].dragging==false)m.style.zIndex=0}}function j(){g.clearRect(0,0,m.width,m.height);for(var e=0;e<b.length;e++){var t=b[e];if(t.dragging){t.target=Math.max(Math.min(y.x/o,1),-1)}t.progress+=(t.target-t.progress)*.2;if(t.dragging||Math.abs(t.progress)<.997){F(t)}}}function F(e){var t=1-Math.abs(e.progress);if(t<.01)t=.01;var n=o*.5*(1-e.progress);var r=o*(1+e.progress);var s=o*e.progress+n;var u=20*t;var c=o*.5*Math.max(Math.min(1-e.progress,.5),0);var h=o*.5*Math.max(Math.min(t,.5),0);var p=o*.5*Math.max(Math.min(t,.5),0);e.page.style.width=Math.max(s,0)+"px";e.pageE.style.width=Math.max(n-4,0)+"px";e.pageE.style.left=Math.max(r+12,0)+"px";e.pageE.style.background="#FAFAFA";g.translate(l+i/2,f+l);g.strokeStyle="rgba(0,0,0,"+.05*t+")";g.lineWidth=30*t;g.beginPath();g.moveTo(s-n,-u*.5);g.lineTo(s-n,a+u*.5);g.stroke();var d=g.createLinearGradient(s,0,s+h,0);d.addColorStop(0,"rgba(0,0,0,"+t*.2+")");d.addColorStop(.8,"rgba(0,0,0,0.0)");g.fillStyle=d;g.beginPath();g.moveTo(s,0);g.lineTo(s+h,0);g.lineTo(s+h,a);g.lineTo(s,a);g.fill();var v=g.createLinearGradient(s-n-p,0,s-n,0);v.addColorStop(0,"rgba(0,0,0,0.0)");v.addColorStop(1,"rgba(0,0,0,"+t*.15+")");g.fillStyle=v;g.beginPath();g.moveTo(s-n-p,0);g.lineTo(s-n,0);g.lineTo(s-n,a);g.lineTo(s-n-p,a);g.fill();var m=g.createLinearGradient(s-c,0,s,0);m.addColorStop(.35,"#fafafa");m.addColorStop(.73,"#f0f0f0");m.addColorStop(.9,"#fafafa");m.addColorStop(1,"#f5f5f5");g.fillStyle=m;g.strokeStyle="rgba(0,0,0,0.06)";g.lineWidth=.5;g.beginPath();g.moveTo(s,0);g.lineTo(s,a);g.quadraticCurveTo(s,a+u*2,s-n,a+u);g.lineTo(s-n,-u);g.quadraticCurveTo(s,-u*2,s,0);g.fill();g.stroke();g.restore()}var n=$("#edit_main_book").innerWidth();var r=$("#edit_main_book").innerHeight();var i=e;var s=t;var o=Math.abs(e/2-10);var u=Math.abs(e/2);var a=t-10;var f=(s-a)/2;var l=20;var c=0;var h=0;var p=0;var d=0;var v="";var m=document.getElementById("pageflip-canvas");var g=m.getContext("2d");var y={x:0,y:0};var b=[];$("#book").css({width:e,height:t});$("#pages section._left").css({height:a});$("#pages section._right").css({width:o,height:a,left:u});$("#pages section div.canvas_container").css({width:o-22,height:a-20});$("section").filter(":first").css({width:o,left:"10px","z-index":"1"});var w=document.getElementById("book");var E=w.getElementsByTagName("section");var S=E.length;for(var x=0,T=E.length;x<T;x++){if(x%2==0){E[x].style.zIndex=x+100}else{E[x].style.zIndex=T-x;b.push({progress:1,target:1,page:E[x],pageE:E[x+1],dragging:false})}}m.width=i+l*2;m.height=s+l*2;m.style.top=-l+"px";m.style.left=-l+"px";var N=setInterval(j,1e3/10);var C=0;var k=0;var L;var A;var O;var M;var _;var D=0;$("div#fold_left p").on("mousedown",function(e){if(e.which==1){M=true;_=false;y.x=o;c-=1;c<0?c=0:c;b[c].dragging=true;d=c;if(b[d].dragging){m.style.zIndex=100}}}).on("mouseup",function(e){if(e.which==1){for(var t=0;t<b.length;t++){if(b[t].dragging){$("#pagination ul li.current").removeClass("current");var n=$(b[t].page).attr("id");$("li#"+n).addClass("current").prev().addClass("current")}b[t].dragging=false;if(b[t].dragging==false)m.style.zIndex=0}}}).on("mouseenter",function(){$(document).off("mousemove",P).off("mousedown",H).off("mouseup",B)}).on("mouseleave",function(){$(document).on("mousemove",P)});$("div#fold_right p").on("mousedown",function(e){if(e.which==1){M=false;_=true;y.x=-o;c>8?c=9:c;b[c].dragging=true;d=c;if(b[d].dragging){m.style.zIndex=100}c+=1}}).on("mouseup",function(e){if(e.which==1){for(var t=0;t<b.length;t++){if(b[t].dragging){c+=1;$("#pagination ul li.current").removeClass("current");var n=$(b[t+1].page).attr("id");$("li#"+n).addClass("current").prev().addClass("current");if(d!=c){c=Math.max(c-1,0)}}b[t].dragging=false;if(b[t].dragging==false)m.style.zIndex=0}}}).on("mouseenter",function(){$(document).off("mousemove",P).off("mousedown",H).off("mouseup",B)}).on("mouseleave",function(){$(document).on("mousemove",P)});$("div#pagination ul li").each(function(e,t){$(this).on("mousedown",function(t){var n=e+1;n%2==0?n=n-1:n;k=Math.round(n/2);if(C==0||k>C){y.x=-o;c=k-1;k-1>=9?c=9:c;for(var r=0;r<c;r++){b[r].dragging=true}d=c;if(b[d].dragging){m.style.zIndex=100}L=true}else{y.x=o;c=k-1;c<0?c=0:c;for(var r=C-1;r>=c;r--){b[r].dragging=true}d=c;if(b[d].dragging){m.style.zIndex=100}A=true}}).on("mouseup",function(e){if($("p#_curr").hasClass("_current")){$("#book_cover").addClass("hideDiv").fadeOut();$("#book_content").fadeIn();$("#my_edit").fadeIn("slow");$("p#_curr").removeClass("_current")}if(L==true){for(var t=0;t<b.length;t++){if(b[t].dragging){$("#pagination ul li.current").removeClass("current");var n=$(b[t+1].page).attr("id");$("li#"+n).addClass("current").prev().addClass("current");if(d!=c){c=Math.max(c-1,0)}}b[t].dragging=false;if(b[t].dragging==false)m.style.zIndex=0;L=false}}else if(A==true){for(var t=0;t<b.length;t++){if(b[t].dragging){$("#pagination ul li.current").removeClass("current");var r=$(b[c].page).attr("id");$("li#"+r).addClass("current").prev().addClass("current")}b[t].dragging=false;if(b[t].dragging==false)m.style.zIndex=0;A=false}}C=k}).on("mouseenter",function(){$(document).off("mousemove",P).off("mousedown",H).off("mouseup",B)}).on("mouseleave",function(){})}).on("mouseenter",function(){$(document).off("mousemove",P).off("mousedown",H).off("mouseup",B)}).on("mouseleave",function(){$(document).on("mousemove",P)})}function loadPopup(){$("#backgroundPopup").css({opacity:"0.3"});$("#backgroundPopup").fadeIn("fast",function(){$("#popupContact").fadeIn("slow")})}function customLoad(){$("#backgroundPopup").css({opacity:"0.3"});$("#backgroundPopup").fadeIn("fast",function(){$("#popup_load").fadeIn("slow")})}function disablePopup(){$("#popupContact").fadeOut("slow",function(){$("#backgroundPopup").fadeOut("fast").remove();$("#popupContact").remove()});$("#popup_load").fadeOut("fast",function(){$("#backgroundPopup").fadeOut("fast").remove()})}function centerPopup(e){var t=document.documentElement.clientWidth;var n=document.documentElement.clientHeight;var r=$("#popupContact").height();var i=$("#popupContact").width();r>1e3?r=1e3:r;$("#popupContact").css({"z-index":"99999",position:"absolute",top:e+"px",left:t/2-i/2});$("#popup_load").css({"z-index":"99999",position:"absolute",top:e+"px",left:t/2-i/2});$("#backgroundPopup").css({height:n});FB.Canvas.scrollTo(0,e)}function showComMessage(e,t,n,r,i){$(body).append('<div div="backgroundPopup"></div>');$("#backgroundPopup").append('<div div="backgroundPopup"></div>');var s="<span class='"+t+"'>"+e+"</span>";if(undefined==n){n=""}var o='<a id="popupContactClose">Close</a><div id="popup_head"><h1>'+n+'</h1></div>  <div id="personal">'+s+"</div>";o;$("#popupContact").html(o);var u=i==0||i==""||i==undefined?300:i;centerPopup(u);loadPopup();if(r!=true){$(".c_btn, .s_btn, #popupContactClose").unbind("click");$(".c_btn, .s_btn, #popupContactClose").bind("click",disablePopup)}}function showLoading(e){var t="<p>"+e+"</p>";$("#popup_load").html(t);centerPopup(300);customLoad()}function doUnqiueStuff(){}function get_add_friends_pop(){FB.init({appId:"331059976950036",xfbml:true,cookie:true});FB.ui({method:"apprequests",display:"popup",message:"Hard Cover Request",title:"HardCover view my book request"},requestCallbacksee)}function checkPermissions(){FB.api("me/permissions",function(e){var t=["user_photos","user_likes","read_stream","user_status","status_updates"];$.each(t,function(t,n){if(!e||!e.data[0]||!(n in e.data[0])){logIn()}})})}function logIn(){FB.login(function(e){if(e.authResponse){}},{scope:"user_photos,user_likes,user_status,staus_updates,read_stream"});return false}function loadFriendsImage(){FB.getLoginStatus(function(e){if(e.status=="connected"){$("#ul_friend_img li").remove();FB.api("me/friends",function(e){$.each(e.data,function(t){if(t==27){return false}var n="https://graph.facebook.com/"+e.data[t].id+"/picture";var r="http://dev.hardcover.me/images/x.png";$("#ul_friend_img").append('<li id="'+e.data[t].id+'" class="float_left"><img src="'+n+'"><img id='+e.data[t].id+' class="ximg" src="'+r+'"></li>')})});gPicture()}else{logIn()}},true)}function getUserID(){var e;FB.api("me",function(t){e=t.id;return e})}function gPicture(e){FB.api("me",function(t){var n="https://graph.facebook.com/"+t.id+"/picture?type=large";$("#"+e).prepend('<img src="'+n+'" class="float_left" style="margin:152px 0 0 255px;position:absolute;z-index:999999999;padding:10px;border:1px solid #CBCBCB;background:#FAFAFA;" width=180 height=150/>')})}function loadAlbum(e){FB.getLoginStatus(function(t){if(t.status=="connected"){$("#photos_from_album li").remove();FB.api("/me/albums&access_token="+t.authResponse.accessToken,function(n){if(e!=undefined){if(e.length!=0||e.length!=undefined){var r=e.split(";");$.each(n.data,function(e){if(n.data[e].count!=undefined){var i=false;$.each(r,function(r,s){if(s==n.data[e].id){var o="https://graph.facebook.com/"+n.data[e].cover_photo+"/picture?type=thumbnail&access_token="+t.authResponse.accessToken;$("#photos_from_album").append("<li id="+n.data[e].id+"><img src="+o+" id="+n.data[e].id+' width=75 height=75/><p><input type="checkbox" name="album_'+n.data[e].id+'" checked="checked"><span>'+n.data[e].count+"</span></p></li>").load(function(){$(this).animate({opacity:1},"slow")});i=true;return false}});if(!i){var s="https://graph.facebook.com/"+n.data[e].cover_photo+"/picture?type=thumbnail&access_token="+t.authResponse.accessToken;$("#photos_from_album").append("<li id="+n.data[e].id+"><img src="+s+" id="+n.data[e].id+' width=75 height=75/><p><input type="checkbox" name="album_'+n.data[e].id+'"><span>'+n.data[e].count+"</span></p></li>").load(function(){$(this).animate({opacity:1},"slow")})}}})}else{$.each(n.data,function(e){if(n.data[e].count!=undefined){var r="https://graph.facebook.com/"+n.data[e].cover_photo+"/picture?type=thumbnail&access_token="+t.authResponse.accessToken;$("#photos_from_album").append("<li id="+n.data[e].id+"><img src="+r+" id="+n.data[e].id+' width=75 height=75/><p><input type="checkbox" name="album_'+n.data[e].id+'"><span>'+n.data[e].count+"</span></p></li>").load(function(){$(this).animate({opacity:1},"fast")})}})}}})}else{logIn()}},true)}function addToAlbum(e,t){FB.getLoginStatus(function(n){if(n.status==="connected"){FB.api("/me/albums&access_token="+n.authResponse.accessToken,function(r){FB.api("me/photos?access_token="+n.authResponse.accessToken,"post",{message:"Edited by HardCover Application",url:e},function(e){if(!e||e.error){alert(e.error.message)}else{var r=e.id+"/?access_token="+n.authResponse.accessToken;alert("This image has been posted in your album...");FB.api(r,function(e){console.log(e);$.ajax({url:"main/set_edited_image",type:"post",data:{fb_dataid:t,url:e.source},error:function(e){console.log(e.error)}})})}})})}else if(n.status==="not_authorized"){logIn()}},true)}function getCookie(){}jQuery.easing["jswing"]=jQuery.easing["swing"];jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,r,i){return jQuery.easing[jQuery.easing.def](e,t,n,r,i)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t+n;return-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t*t+n;return r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t*t*t+n;return-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){if((t/=i/2)<1)return r/2*t*t*t*t*t+n;return r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){if(t==0)return n;if(t==i)return n+r;if((t/=i/2)<1)return r/2*Math.pow(2,10*(t-1))+n;return r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){if((t/=i/2)<1)return-r/2*(Math.sqrt(1-t*t)-1)+n;return r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158;var o=0;var u=r;if(t==0)return n;if((t/=i)==1)return n+r;if(!o)o=i*.3;if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158;var o=0;var u=r;if(t==0)return n;if((t/=i)==1)return n+r;if(!o)o=i*.3;if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158;var o=0;var u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;if(!o)o=i*.3*1.5;if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);if(t<1)return-.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n;return u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){if(s==undefined)s=1.70158;return r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){if(s==undefined)s=1.70158;return r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){if(s==undefined)s=1.70158;if((t/=i/2)<1)return r/2*t*t*(((s*=1.525)+1)*t-s)+n;return r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,i){return r-jQuery.easing.easeOutBounce(e,i-t,0,r,i)+n},easeOutBounce:function(e,t,n,r,i){if((t/=i)<1/2.75){return r*7.5625*t*t+n}else if(t<2/2.75){return r*(7.5625*(t-=1.5/2.75)*t+.75)+n}else if(t<2.5/2.75){return r*(7.5625*(t-=2.25/2.75)*t+.9375)+n}else{return r*(7.5625*(t-=2.625/2.75)*t+.984375)+n}},easeInOutBounce:function(e,t,n,r,i){if(t<i/2)return jQuery.easing.easeInBounce(e,t*2,0,r,i)*.5+n;return jQuery.easing.easeOutBounce(e,t*2-i,0,r,i)*.5+r*.5+n}});jQuery.cookie=function(e,t,n){if(arguments.length>1&&String(t)!=="[object Object]"){n=jQuery.extend({},n);if(t===null||t===undefined){n.expires=-1}if(typeof n.expires==="number"){var r=n.expires,i=n.expires=new Date;i.setDate(i.getDate()+r)}t=String(t);return document.cookie=[encodeURIComponent(e),"=",n.raw?t:encodeURIComponent(t),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}n=t||{};var s,o=n.raw?function(e){return e}:decodeURIComponent;return(s=(new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)")).exec(document.cookie))?o(s[1]):null};var book_width=740,book_height=290,book_font_size=12,font_size=12,preview_margin=200;var ret_object="";var __pagenum="";var arrObj;var book_preview=new Array(1);book_preview[0]=740;book_preview[1]=290;book_preview[2]=12;var book_sizes=new Array;book_sizes[0]=new Array(2);book_sizes[0][0]=740;book_sizes[0][1]=290;book_sizes[0][2]=.57;book_sizes[0][3]=1024;book_sizes[1]=new Array(2);book_sizes[1][0]=940;book_sizes[1][1]=370;book_sizes[1][2]=.72;book_sizes[1][3]=1280;book_sizes[2]=new Array(2);book_sizes[2][0]=1240;book_sizes[2][1]=480;book_sizes[2][2]=.95;book_sizes[2][3]=1440;book_sizes[3]=new Array(2);book_sizes[3][0]=1600;book_sizes[3][1]=630;book_sizes[3][2]=1.25;book_sizes[3][3]=1920;var sizeHT=new Array(4);sizeHT[0]=290;sizeHT[1]=370;sizeHT[2]=480;sizeHT[3]=630;$(window).load(resizeWindow());(function(e){var t=[];e.loadImage=function(){var e=arguments.length;var n;for(var r=e;r--;){var i=document.createElement("img");n=arguments[r].split("~");i.setAttribute("id",n[1]);i.src=n[0];t.push(i)}};_arr_=t})(jQuery);(function(e){e.fn.onImagesLoaded=function(t){return this.each(function(){var n=this.tagName.toLowerCase()==="img"?e(this):e("img",this),r=this,i=0,s=function(){if(typeof t==="function")t(r)};if(n.length){n.each(function(){var t=this,r=function(r){if(t.complete||t.readyState=="complete"&&r.type=="readystatechange"){if(++i===n.length)s()}else if(t.readyState===undefined){e(t).attr("src",e(t).attr("src"))}};e(t).bind("load readystatechange",function(e){r(e)});r({type:"readystatechange"})})}else s()})}})(jQuery);var pagenum;var xnum=0;var wd=Math.floor(book_width/4-15);var act_wd=book_width;var pg_wd=Math.floor(book_width/2-21);var hd=book_height;var html;var htImg=0;var imgPic=hd*.1;var __pagenum="";var _msg;var _heightOf;var npage;(function(e){function t(t,r,i,s,o,u){var a=0;var f=0;var l=0;var c=[];var h=[];var p=false;var d=false;var v=1;var m=0;var g;var y=0;var b=0;var w=wd-8;var E;e.each(t,function(t,i){var s=i.comment_obj.from.name;var f="https://graph.facebook.com/"+i.comment_obj.from.id+"/picture?type=small";if(o==4){e("ul#ul-"+r).append('<li id="comment_'+t+i.book_comment_id+"_"+t+'" style="width:auto;min-height:35px;"><div class="pic_cn float_left" style="height:'+imgPic+'px;width:15%;"><img src="'+f+'" class="float_left"></div><p style="font-size:'+font_size+'px" class="comment_by">'+s+'</p><p class="float_left fbcomment" style="font-size:'+font_size+'px">'+i.comment_obj.message+"</p></li>");a=Math.floor(a+parseInt(e("li#comment_"+t+i.book_comment_id+"_"+t).height())+10.5);a=Math.floor(a+u)}else{e("ul#ul-"+r).append('<li id="comment_'+t+i.book_comment_id+"_"+t+'" style="width:'+w+'px;min-height:35px;"><div class="pic_cn float_left" style="height:'+imgPic+'px;"><img src="'+f+'" class="float_left"></div><p class="comment_by" style="font-size:'+font_size+'px">'+s+'</p><p class="float_left fbcomment" style="font-size:'+font_size+'px">'+i.comment_obj.message+"</p></li>");a=Math.floor(a+e("li#comment_"+t+i.book_comment_id+"_"+t).height()+10.5)}pagenum=n(xnum,o,pagenum,2,i.book_comment_id);if(a>=hd){var l=i.comment_obj.message.replace(";"," ");e("#ul-"+r+" li#comment_"+t+i.book_comment_id+"_"+t).remove();c.push({data:f+";"+s+";"+l+";"+i.book_comment_id});p=true}});if(p){var S='<div id="nxt-'+r+'" class="pagefx">';S+='<ul id="ul-'+r+'_1" class="float_left comment_layout1" style="width:'+w+'px">';S+="</ul>";S+='<ul id="ul-'+r+'_2" class="float_left comment_layout1" style="width:'+w+'px;margin:0 0 0 10px;">';S+="</ul>";S+="</div>";e("#pages").append(S);xnum++;e.each(c,function(t,i){var s=i.data.split(";");e("ul#ul-"+r+"_1").append('<li id="comment_'+t+"_1"+s[3]+'_1" style="width:'+w+'px;"><div class="pic_cn float_left" style="height:'+imgPic+'px;"><img src="'+s[0]+'" class="float_left"></div><p class="comment_by" style="font-size:'+font_size+'px">'+s[1]+'</p><p class="float_left fbcomment" style="font-size:'+font_size+'px">'+s[2]+"</p></li>");pagenum=n(xnum,o,pagenum,2,s[3]);f=Math.floor(f+e("li#comment_"+t+"_1"+s[3]+"_1").height()+10.5);if(f>hd){e("#ul-"+r+"_1"+" li#comment_"+t+"_1"+s[3]+"_1").remove();h.push({data:s[0]+";"+s[1]+";"+s[2]+";"+s[3]});d=true}});if(d){var x=[];var T=false;e.each(h,function(t,i){var s=i.data.split(";");e("ul#ul-"+r+"_2").append('<li id="comment_'+t+"_2"+s[3]+'_2" style="width:'+w+'px;"><div class="pic_cn float_left" style="height:'+imgPic+'px;"><img src="'+s[0]+'" class="float_left"></div><p class="comment_by" style="font-size:'+font_size+'px">'+s[1]+'</p><p class="float_left fbcomment" style="font-size:'+font_size+'px">'+s[2]+"</p></li>");pagenum=n(xnum,o,pagenum,2,s[3]);l=Math.floor(l+e("#comment_"+t+"_2"+s[3]+"_2").height()+10.5);if(l>hd){e("ul#ul-"+r+"_2"+" li#comment_"+t+"_2"+s[3]+"_2").remove();x.push({data:s[0]+";"+s[1]+";"+s[2]+";"+s[3]});T=true}});if(T){var N=[];var C=0;var k=false;var S='<div id="next-'+r+'_1" class="pagefx">';S+='<ul id="ul-'+r+'_1A" class="float_left comment_layout1" style="width:'+w+'px">';S+="</ul>";S+='<ul id="ul-'+r+'_2A" class="float_left comment_layout1" style="width:'+w+'px;margin:0 0 0 10px;">';S+="</ul>";S+="</div>";e("#pages").append(S);xnum++;e.each(x,function(t,i){var s=i.data.split(";");e("ul#ul-"+r+"_1A").append('<li id="comment_'+t+"_1A"+s[3]+'_1A" style="width:'+w+'px;"><div class="pic_cn float_left" style="height:'+imgPic+'px;"><img src="'+s[0]+'" class="float_left"></div><p class="comment_by" style="font-size:'+font_size+'px">'+s[1]+'</p><p class="float_left fbcomment" style="font-size:'+font_size+'px">'+s[2]+"</p></li>");pagenum=n(xnum,o,pagenum,2,s[3]);C=Math.floor(C+e("li#comment_"+t+"_1A"+s[3]+"_1A").height()+10.5);if(C>hd){e("ul#ul-"+r+"_1A"+" li#comment_"+t+"_1A"+s[3]+"_1A").remove();N.push({data:s[0]+";"+s[1]+";"+s[2]+";"+s[3]});k=true}});if(k){var L=0;e.each(N,function(t,i){var s=i.data.split(";");e("#ul-"+r+"_2A").append('<li id="comment_'+t+"_2A"+s[3]+'_2A" style="width:'+w+'px;"><div class="pic_cn float_left" style="height:'+imgPic+'px;"><img src="'+s[0]+'" class="float_left"></div><p class="comment_by" style="font-size:'+font_size+'px">'+s[1]+'</p><p class="float_left fbcomment" style="font-size:'+font_size+'px">'+s[2]+"</p></li>");L=Math.floor(L+e("#comment_"+t+"_2A"+s[3]+"_2A").height()+10.5);pagenum=n(xnum,o,pagenum,2,s[3]);if(L>hd){e("#comment_"+t+"_2A"+s[3]+"_2A").remove()}})}}}}}function n(e,t,n,r,i){var s="";if(r==1)s="fbid_";else if(r==2)s="cid_";if(__pagenum!="undefined"){if(__pagenum.length!=0)n=__pagenum+","+s+i+":"+e+":"+t;else n=s+i+":"+e+":"+t}__pagenum=n;return n}e.fn.pageLayout=function(r){var i=e.extend({},e.fn.pageLayout.defaults,r);xnum=i.pindex;if(i.isObject){var s=false;var o;e("#pages").empty();e("#pages").append("<div id='cover'></div><div class='pagefx'></div>");e.each(i.object.book_pages,function(r,s){if(i.divId==s.fbdata.id){arrObj[r]=s.fbdata.id+":"+i.layout;o=i.layout}else{var u=arrObj[r].split(":");o=u[1]}if(o==1){if(s.fbdata.height>hd){if(s.connection=="statuses"){var a='<p id="msg-'+s.fbdata.id+'">'+s.fbdata.message+"</p>"}else{var a='<img src="'+s.fbdata.source+'" id="img-'+s.fbdata.id+'" width="100%" class="editable"/>'}l='<div id="'+s.fbdata.id+'" class="pagefx">';l+='<div id="div-'+s.fbdata.id+'" class="float_left img_layout1" style="height:100%">';l+=a;l+="</div><!--End of Image-->";l+='<ul id="ul-'+s.fbdata.id+'" class="float_left comment_layout1">';l+="</ul>";l+="</div>";xnum++;pagenum=n(xnum,o,pagenum,1,s.fbdata.id)}else{var f=s.fbdata.height;if(s.connection=="statuses"){var a='<p id="msg-'+s.fbdata.id+'">'+s.fbdata.message+"</p>"}else{var a='<img src="'+s.fbdata.source+'" id="img-'+s.fbdata.id+'" height="'+f+'" class="editable"/>'}l='<div id="'+s.fbdata.id+'" class="pagefx">';l+='<div id="div-'+s.fbdata.id+'" class="float_left img_layout1" style="height:'+f+'">';l+=a;l+="</div><!--End of Image-->";l+='<ul id="ul-'+s.fbdata.id+'" class="float_left comment_layout1">';l+="</ul>";l+="</div>";xnum++;pagenum=n(xnum,o,pagenum,1,s.fbdata.id)}e("#pages").append(l);if(s.comment.length!=0)t(s.comment,s.fbdata.id,i.pagenum,true,o)}else if(o==2){if(s.fbdata.height>hd){if(s.connection=="statuses"){var a='<p id="msg-'+s.fbdata.id+'">'+s.fbdata.message+"</p>"}else{var a='<img src="'+s.fbdata.source+'" id="img-'+s.fbdata.id+'" width="100%" class="editable"/>'}l='<div id="'+s.fbdata.id+'" class="pagefx">';l+='<ul id="ul-'+s.fbdata.id+'" class="float_left comment_layout2">';l+="</ul>";l+='<div id="div-'+s.fbdata.id+'" class="float_right img_layout2" style="height:100%">';l+=a;l+="</div><!--End of Image-->";l+="</div>";xnum++;pagenum=n(xnum,o,pagenum,1,s.fbdata.id)}else{var f=s.fbdata.height;if(s.connection=="statuses"){var a='<p id="msg-'+s.fbdata.id+'">'+s.fbdata.message+"</p>"}else{var a='<img src="'+s.fbdata.source+'" id="img-'+s.fbdata.id+'" height="'+f+'" class="editable"/>'}l='<div id="'+s.fbdata.id+'" class="pagefx">';l+='<ul id="ul-'+s.fbdata.id+'" class="float_left comment_layout2">';l+="</ul>";l+='<div id="div-'+s.fbdata.id+'" class="float_right img_layout2" style="height:'+f+'">';l+=a;l+="</div><!--End of Image-->";l+="</div>";xnum++;pagenum=n(xnum,o,pagenum,1,s.fbdata.id)}e("#pages").append(l);if(s.comment.length!=0)t(s.comment,s.fbdata.id,i.pagenum,true,o)}else if(o==3){var l='<div id="div-'+s.fbdata.id+'" class="img_layout3" style="height:100%">';l+='  <div id="col_layout3_left" class="float_left">';l+='   <div id="div-A" class="img_layout3">';l+='    <img src="'+s.fbdata.source+'" id="img-'+s.fbdata.id+'" width="100%" class="editable"/>';l+="   </div><!--End of Image-->";l+='  <ul id="'+s.book_info_id+"_"+r+'" class="float_left comment_layout3_left">';l+="  </ul>";l+="  </div>";l+=" </div><!---End of col_layout3-left-->";l+=' <div id="col_layout3_right" class="float_right">';l+='  <ul id="'+s.book_info_id+"_"+r+'" class="float_left comment_layout3_left">';l+="  </ul>";l+='  <div id="div-B" class="img_layout3_down">';l+='   <img src="'+s.fbdata.source+'" id="img-'+s.fbdata.id+'" width="100%" class="editable"/>';l+="  </div><!--End of Image-->";l+=" </div>";l+="</div>";e("#pages").append(l);xnum++;pagenum=n(xnum,o,pagenum,1,s.fbdata.id);if(s.comment.length!=0)t(s.comment,s.fbdata.id,i.pagenum,true,o)}else if(o==4){var c;if(s.fbdata.width>s.fbdata.height)c='width="100%"';else if(s.fbdata.width<s.fbdata.height)c='height="100%"';else if(s.fbdata.width==s.fbdata.height)c='width="100%" height="100%"';var c;if(s.fbdata.width>s.fbdata.height){s.fbdata.width<pg_wd?c=s.fbdata.width:c='width="100%"'}else if(s.fbdata.width<s.fbdata.height){s.fbdata.height<hd?c=s.fbdata.height:c='height="100%"'}else if(s.fbdata.width==s.fbdata.height){var h;var p;s.fbdata.width<pg_wd?h=s.fbdata.width:h='"width:100%"';s.fbdata.height<hd?p=s.fbdata.height:p='"height:100%"';c=h+" "+p}var l='<div id="'+s.fbdata.id+'" class="pagefx">';l+='   <div id="div-'+s.fbdata.id+'" style="width:'+pg_wd+"px; max-height:"+hd+'px; overflow:hidden;">';l+="   </div>";l+="</div>";e("#pages").append(l);s.connection=="statuses"?a='<p id="msg-'+s.fbdata.id+'">'+s.fbdata.message+"</p>":a='<img src="'+s.fbdata.source+'" id="img-'+s.fbdata.id+'" class="editable" '+c+"/>";if(s.connection!=="statuses"&&s.comment.length>0){_heightOf=hd*.78;e("#div-"+s.fbdata.id).css({"max-height":_heightOf});if(e("#img-"+s.fbdata.id).attr("src")!="undefined"){e("#img-"+s.fbdata.id).onImagesLoaded(function(t){e(t).fadeIn(3e3)})}e("#div-"+s.fbdata.id).append(a);var l='<ul id="ul-'+s.fbdata.id+'" class="comment_layout4"></ul>';e("#"+s.fbdata.id).append(l)}else if(s.connection==="statuses"&&s.comment.length>0){_heightOf=hd*.78;e("#msg-"+s.fbdata.id).css({height:_heightOf});e("#div-"+s.fbdata.id).append(a);var l='<ul id="ul-'+s.fbdata.id+'" class="comment_layout4"></ul>';e("#"+s.fbdata.id).append(l)}else{_heightOf=hd*.96;e("#div-"+s.fbdata.id).css({"max-height":_heightOf});e("#div-"+s.fbdata.id).append(a);if(e("#img-"+s.fbdata.id).attr("src")!==undefined){e("#img-"+s.fbdata.id).onImagesLoaded(function(t){e(t).fadeIn(3e3)})}else if(s.connection==="statuses"){e("#msg-"+s.fbdata.id).css({height:_heightOf})}}if(s.connection!=="statuses"){var d=e("#img-"+s.fbdata.id).width();var v=e("#img-"+s.fbdata.id).height();var m=e("#img-"+s.fbdata.id).offsetParent().width();if(c=='width="100%"'||c=='height="100%"'){var g=Math.floor(100*d/m);c=='width="100%"'?g=0:g}else if(d===v){var g=Math.floor(100*d/m)}e("#img-"+s.fbdata.id).css({"margin-left":g})}xnum++;if(i.divId==s.fbdata.id)npage=xnum;pagenum=n(xnum,o,pagenum,1,s.fbdata.id);if(s.comment.length!=0)t(s.comment,s.fbdata.id,i.pagenum,true,o,_heightOf)}else{}})}else{if(i.layout==1){if(i.fbdata.height>hd){if(i.connection=="statuses"){var u='<p id="msg-'+i.fbdata.id+'">'+i.fbdata.message+"</p>"}else{var u='<img src="'+i.fbdata.source+'" id="img-'+i.fbdata.id+'" width="100%" class="editable"/>'}f='<div id="'+i.fbdata.id+'" class="pagefx">';f+='<div id="div-'+i.fbdata.id+'" class="float_left img_layout1" style="height:100%">';f+=u;f+="</div><!--End of Image-->";f+='<ul id="ul-'+i.fbdata.id+'" class="float_left comment_layout1">';f+="</ul>";f+="</div>";xnum++;pagenum=n(xnum,i.layout,pagenum,1,i.fbdata.id)}else{var a=i.fbdata.height;if(i.connection=="statuses"){var u='<p id="msg-'+i.fbdata.id+'">'+i.fbdata.message+"</p>"}else{var u='<img src="'+i.fbdata.source+'" id="img-'+i.fbdata.id+'" height="'+a+'" class="editable"/>'}f='<div id="'+i.fbdata.id+'" class="pagefx">';f+='<div id="div-'+i.fbdata.id+'" class="float_left img_layout1" style="height:'+a+'">';f+=u;f+="</div><!--End of Image-->";f+='<ul id="ul-'+i.fbdata.id+'" class="float_left comment_layout1">';f+="</ul>";f+="</div>";xnum++;pagenum=n(xnum,i.layout,pagenum,1,i.fbdata.id)}e("#pages").append(f);if(i.comment.length!=0)t(i.comment,i.fbdata.id,i.pagenum,false,i.layout)}else if(i.fbdata==2){if(i.fbdata.height>hd){if(i.connection=="statuses"){var u='<p id="msg-'+i.fbdata.id+'">'+i.fbdata.message+"</p>"}else{var u='<img src="'+i.fbdata.source+'" id="img-'+i.fbdata.id+'" width="100%" class="editable"/>'}var f='<div id="'+i.fbdata.id+'" class="pagefx">';f+='<ul id="ul-'+i.fbdata.id+'" class="float_left comment_layout2">';f+="</ul>";f+='<div id="div-'+i.fbdata.id+'" class="float_right img_layout2" style="height:100%">';f+=u;f+="</div><!--End of Image-->";f+="</div>";xnum++;pagenum=n(xnum,i.layout,pagenum,1,i.fbdata.id)}else{var a=i.fbdata.height;if(i.connection=="statuses"){var u='<p id="msg-'+i.fbdata.id+'">'+i.fbdata.message+"</p>"}else{var u='<img src="'+i.fbdata.source+'" id="img-'+i.fbdata.id+'" height="'+a+'" class="editable"/>'}var f='<div id="'+i.fbdata.id+'" class="pagefx">';f+='<ul id="ul-'+i.fbdata.id+'" class="float_left comment_layout2">';f+="</ul>";f+='<div id="div-'+i.fbdata.id+'" class="float_right img_layout2" style="height:'+a+'">';f+=u;f+="</div><!--End of Image-->";f+="</div>";xnum++;pagenum=n(xnum,i.layout,pagenum,1,i.fbdata.id)}e("#pages").append(f);if(i.comment.length!=0)t(i.comment,i.fbdata.id,i.pagenum,false,i.layout)}else if(i.layout==3){var f='<div id="div-'+i.fbdata.id+'" class="img_layout3" style="height:100%">';f+='  <div id="col_layout3_left" class="float_left">';f+='   <div id="div-A" class="img_layout3">';f+='    <img src="'+i.fbdata.source+'" id="img-'+i.fbdata.id+'" width="100%" class="editable"/>';f+="   </div><!--End of Image-->";f+='   <ul id="'+i.book_info_id+'" class="float_left comment_layout3_left">';f+="   </ul>";f+="  </div>";f+=" </div>";e("#pages").append(f);xnum++;pagenum=n(xnum,i.layout,pagenum,1,i.fbdata.id);if(i.comment.length!=0)t(i.comment,i.fbdata.id,i.pagenum,false,i.layout)}else if(i.layout==4){var l;if(i.fbdata.width>i.fbdata.height){i.fbdata.width<pg_wd?l=i.fbdata.width:l='width="100%"'}else if(i.fbdata.width<i.fbdata.height){i.fbdata.height<hd?l=i.fbdata.height:l='height="100%"'}else if(i.fbdata.width==i.fbdata.height){var c;var h;i.fbdata.width<pg_wd?c=i.fbdata.width:c='"width:100%"';i.fbdata.height<hd?h=i.fbdata.height:h='"height:100%"';l=c+" "+h}var f='<div id="'+i.fbdata.id+'" class="pagefx">';f+='   <div id="div-'+i.fbdata.id+'" style="width:'+pg_wd+"px; max-height:"+hd+'px; overflow:hidden;">';f+="   </div>";f+="</div>";e("#pages").append(f);i.connection=="statuses"?u='<p id="msg-'+i.fbdata.id+'">'+i.fbdata.message+"</p>":u='<img src="'+i.fbdata.source+'" id="img-'+i.fbdata.id+'" class="editable" '+l+"/>";if(i.connection!=="statuses"&&i.comment.length>0){_heightOf=Math.floor(hd*.78);e("#div-"+i.fbdata.id).css({"max-height":_heightOf});if(e("#img-"+i.fbdata.id).attr("src")!="undefined"){e("#img-"+i.fbdata.id).onImagesLoaded(function(t){e(t).fadeIn(3e3)})}e("#div-"+i.fbdata.id).append(u);var f='<ul id="ul-'+i.fbdata.id+'" class="comment_layout4"></ul>';e("#"+i.fbdata.id).append(f)}else if(i.connection==="statuses"&&i.comment.length>0){_heightOf=Math.floor(hd*.78);e("#msg-"+i.fbdata.id).css({height:_heightOf});e("#div-"+i.fbdata.id).append(u);var f='<ul id="ul-'+i.fbdata.id+'" class="comment_layout4"></ul>';e("#"+i.fbdata.id).append(f)}else{_heightOf=Math.floor(hd*.96);e("#div-"+i.fbdata.id).css({"max-height":_heightOf});e("#div-"+i.fbdata.id).append(u);if(e("#img-"+i.fbdata.id).attr("src")!==undefined){e("#img-"+i.fbdata.id).onImagesLoaded(function(t){e(t).fadeIn(3e3)})}else if(i.connection==="statuses"){e("#msg-"+i.fbdata.id).css({height:_heightOf})}}if(i.connection!=="statuses"){var p=e("#img-"+i.fbdata.id).width();var d=e("#img-"+i.fbdata.id).height();var v=e("#img-"+i.fbdata.id).offsetParent().width();if(l=='width="100%"'||l=='height="100%"'){var m=Math.floor(100*p/v);l=='width="100%"'?m=0:m}else if(p===d){var m=Math.floor(100*p/v)}e("#img-"+i.fbdata.id).css({"margin-left":m})}xnum++;pagenum=n(xnum,4,pagenum,1,i.fbdata.id);if(i.comment.length!=0)t(i.comment,i.fbdata.id,i.pagenum,false,i.layout,_heightOf)}else{}}if(i.isObject){var g='<div class="pagefx"></div>';g+='<div id="back_cover"></div>';e("#pages").append(g);e("#pages").wowBook({height:book_height,width:book_width,centeredWhenClosed:false,hardcovers:true,turnPageDuration:500,flipSound:false,transparentPages:true,updateBrowserURL:true,pageNumbers:false,controls:{zoomIn:"#zoomin",zoomOut:"#zoomout",next:"#fold_right",back:"#fold_left",first:"#first",last:"#last",slideShow:"#slideshow"},hardPages:true}).css({display:"none",margin:"auto"}).fadeIn(1e3);e.wowBook("#pages").showPage(i.pagenum,true);var y=e.wowBook("#pages");e(".paginate ul").empty();var b;e(y.pages).each(function(t,n){if(t==0){}else if(t<=20){var r=t%2;switch(r){case 0:break;default:var i=t+1;var s='<div id="'+t+'" class="paginate-left-page">'+t+"</div>";s+='<div id="'+i+'" class="paginate-right-page">'+i+"</div>";e(".paginate ul").append("<li>"+s+"</li>");break}}b=t});e(".paginate ul").append('<li><div id="elips" class="paginate-left-page">...</div><div class="paginate-right-page" id="'+b+'">'+b+"</div></li>");e(".paginate ul li div").each(function(t){e(this).live("click",function(){var t=e(this).attr("id");e(".paginate ul li div").removeClass("active");if(t!=="elips"){e(this).addClass("active");y.gotoPage(t)}else{return false}})});e.ajax({url:"/main/save_pagenum",data:{pagenum:pagenum},type:"POST",success:function(t){ret_object=e.parseJSON(t)},complete:function(){},error:function(){}});e("#button_container").width(e("#pages").width()).css({left:e("#pages").offset().left-20});e("div.wowbook-page").each(function(t,n){e(this).live("mouseenter",function(){curr_id=e(this).children().get(0).id;e.cookie("div_",curr_id);e(this).hasClass("wowbook-right")?cls="_right":cls="_left";var t=e(this);e("#"+curr_id).addClass("current");e("."+cls+"_icon").fadeIn("slow");e("."+cls+"_icon").hover(function(){e(this).css({opacity:1}).stop(true)}).click(function(){var t=e(this).children("div").get(0).id;var n=e("#page-layout_option").width();var r=n/2;if(cls=="_left"){e("#page-layout_option").css({left:e("#"+t).offset().left-r}).fadeIn("slow")}else{e("#page-layout_option").css({left:e("#"+t).offset().left-n-(r-40)}).fadeIn("slow")}})}).live("mouseleave",function(){curr_id=e(this).children().get(0).id;e("#"+curr_id).removeClass("current");e("."+cls+"_icon").fadeOut("slow")}).live("mousedown",function(){e("#page-layout_option").fadeOut("slow")})});e("img.editable").each(function(t,n){e(this).live("click",function(){e(this).myEditor()})})}return this};e.fn.pageLayout.defaults={divId:0,pagenum:0,comment:{},fbdata:{},layout:4,connection:"photos",isObject:false,object:{},pindex:0}})(jQuery);(function(e){var t,n,r,i;i="quickfit";r={min:8,max:12,tolerance:.02,truncate:false,width:null,sample_number_of_letters:10,sample_font_size:12};n=function(){function n(t){this.options=t;this.item=e('<span id="meassure"></span>');this.item.css({position:"absolute",left:"-1000px",top:"-1000px","font-size":""+this.options.sample_font_size+"px"});e("body").append(this.item);this.meassures={}}var t;t=null;n.instance=function(e){if(!t)t=new n(e);return t};n.prototype.get_meassure=function(e){var t;t=this.meassures[e];if(t===void 0){t=this.set_meassure(e)}return t};n.prototype.set_meassure=function(e){var t,n,r,i,s;i="";r=e===" "?"&nbsp;":e;for(n=0,s=this.options.sample_number_of_letters-1;0<=s?n<=s:n>=s;0<=s?n++:n--){i+=r}this.item.html(i);t=this.item.width()/this.options.sample_number_of_letters/this.options.sample_font_size;this.meassures[e]=t;return t};return n}();t=function(){function t(t,s){this.element=t;this.options=e.extend({},r,s);this.element=e(this.element);this._defaults=r;this._name=i;this.quickfit_helper=n.instance(this.options)}t.prototype.fit=function(){var e;if(!this.options.width){e=this.element.width();this.options.width=e-this.options.tolerance*e}if(this.text=this.element.attr("data-quickfit")){this.previously_truncated=true}else{this.text=this.element.html()}this.calculate_font_size();if(this.options.truncate)this.truncate();return this.element.css("font-size",""+this.font_size+"px")};t.prototype.calculate_font_size=function(){var e,t,n,r,i;t=0;i=this.text;for(n=0,r=i.length;n<r;n++){e=i[n];t+=this.quickfit_helper.get_meassure(e)}this.target_font_size=parseInt(this.options.width/t);return this.font_size=Math.max(this.options.min,Math.min(this.options.max,this.target_font_size))};t.prototype.truncate=function(){var e,t,n,r,i;if(this.font_size>this.target_font_size){r="";i=3*this.quickfit_helper.get_meassure(".")*this.font_size;e=0;while(i<this.options.width&&e<this.text.length){n=this.text[e++];if(t)r+=t;i+=this.font_size*this.quickfit_helper.get_meassure(n);t=n}if(r.length+1===this.text.length){r=this.text}else{r+="..."}this.text_was_truncated=true;return this.element.attr("data-quickfit",this.text).html(r)}else{if(this.previously_truncated)return this.element.html(this.text)}};return t}();return e.fn.quickfit=function(e){return this.each(function(){return(new t(this,e)).fit()})}})(jQuery,window);(function(e){var t={init:function(t){var n=e.extend({itemClass:".item",itemOpenClass:".item_open",openTriggerClass:".item",closeText:"Close",itemMargin:10,scrollSpeed:500,startItem:"last",easing:"easeOutSine",categories:["January","February","March","April","May","June","July","August","September","October","November","December"],nuberOfSegments:[31,29,31,30,31,30,31,31,30,31,30,31],yearsOn:true,swipeOn:true,hideTimeline:false,hideControles:false},t);var r=this,i=e("body"),s=r.find(n.itemClass),o=r.find(n.itemOpenClass),u=s.first().width(),a=o.first().width();r.trigger("init.Timeline");var f=s.length-1;if(n.startItem=="first"){f=0}else if(n.startItem=="last"){f=s.length-1}else{s.each(function(t){if(n.startItem==e(this).attr("data-id")){f=t;return true}})}s.each(function(t){e(this).attr("data-count",t);e(this).next(n.itemOpenClass).attr("data-count",t);if(!e(this).hasClass(n.openTriggerClass)){e(this).find(n.openTriggerClass).attr("data-count",t)}});r.append('<div style="clear:both"></div>');r.css({width:"100%",overflow:"hidden",marginLeft:"auto",marginRight:"auto","text-align":"center",height:0});r.wrapInner('<div class="timeline_items" />');r.find(".timeline_items").css("text-align","left");if(!n.hideControles){r.append('<div class="t_controles"><div class="t_left"></div><div class="t_right"></div></div>')}r.wrapInner('<div class="timeline_items_holder" />');r.find(".timeline_items_holder").css({width:"300px",marginLeft:"auto",marginRight:"auto"});s.css({paddingLeft:0,paddingRight:0,marginLeft:n.itemMargin/2,marginRight:n.itemMargin/2,"float":"left",position:"relative"});o.each(function(){e(this).prepend('<div class="t_close" data-count="'+e(this).attr("data-count")+'" data-id="'+e(this).attr("data-id")+'">'+n.closeText+"</div>");e(this).wrapInner('<div class="'+n.itemOpenClass.substr(1)+'_cwrapper"  />').find("div:first").css({position:"relative"});e(this).css({width:0,padding:0,margin:0,"float":"left",display:"none",position:"relative",overflow:"hidden"})});var l=r.find(".timeline_items:first"),c=r.find(".t_line_wrapper:first"),h=300/2-(u+n.itemMargin)*(1/2+f),p=(u+n.itemMargin)*s.length+(a+n.itemMargin)+660,d=r.data("timeline");console.log(d);l.css({width:p,marginLeft:h});if(!d){r.data("timeline",{currentIndex:f,itemCount:s.length,margin:h,itemWidth:u,itemOpenWidth:a,lineMargin:0,lineViewCount:0,options:n,items:s,iholder:l,open:false,noAnimation:false,marginResponse:false,mousedown:false,mousestartpos:0})}if(!n.hideTimeline){r.timeline("createElements")}e(document).keydown(function(e){if(e.keyCode==37){r.timeline("left");return false}if(e.keyCode==39){r.timeline("right");return false}});r.find(".t_left").click(function(){r.timeline("left")});r.find(".t_right").click(function(){r.timeline("right")});if(n.swipeOn){s.find("*").each(function(){e(this).css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"})});r.bind("touchstart",function(e){r.timeline("touchStart",e.originalEvent.touches[0].pageX)});r.find(n.itemClass).mousedown(function(e){r.timeline("mouseDown",e.pageX)});e(document).bind("touchend",function(e){d=r.data("timeline");r.timeline("touchEnd",d.touchpos)});e(document).mouseup(function(t){var n=e(".timelineLight");var r=n.data("timeline");if(r.mousedown){n.timeline("mouseUp",t.pageX)}})}r.find(n.openTriggerClass).on("click",function(){var t=e(this);setTimeout(function(){console.log(t.attr("data-id"));r.timeline("goTo",t.attr("data-id"),t.attr("data-count"),true)},1e3)});r.find(".t_close").on("click",function(){r.timeline("close",e(this).attr("data-id"),e(this).attr("data-count"))});r.css({height:"auto"}).show();r.prev(".timelineLoader").hide();r.find(".t_line_node").each(function(){if(e(this).width()<10)e(this).width(12);e(this).css({marginLeft:-e(this).width()/2})});return r},destroy:function(){e(document).unbind("mouseup");e(window).unbind("resize");var t=this,n=t.data("timeline");t.removeData("timeline")},touchStart:function(e){var t=this,n=t.data("timeline"),r=0;n.mousedown=true;n.mousestartpos=e;t.bind("touchmove",function(t){n.touchpos=t.originalEvent.touches[0].pageX;r=n.margin-e+t.originalEvent.touches[0].pageX;n.iholder.css("marginLeft",r+"px")})},mouseDown:function(t){var n=this,r=n.data("timeline"),i=0;r.mousedown=true;r.mousestartpos=t;e("body").css("cursor","move");e(document).mousemove(function(e){i=r.margin-t+e.pageX;r.iholder.css("marginLeft",i+"px")})},touchEnd:function(e){var t=this,n=t.data("timeline"),r=n.itemWidth+n.options.itemMargin,i=n.currentIndex,s=0,o=e-n.mousestartpos;n.mousedown=false;i-=parseInt(o/r);s=o%r;if(o<0&&s<-r/2){i++}if(o>0&&s>r/2){i--}if(i<0){i=0}if(i>=n.itemCount){i=n.itemCount-1}t.timeline("goTo",n.items.eq(i).attr("data-id"),n.items.eq(i).attr("data-count"))},mouseUp:function(t){var n=this,r=n.data("timeline"),i=r.itemWidth+r.options.itemMargin,s=r.currentIndex,o=0,u=t-r.mousestartpos;r.mousedown=false;e(document).unbind("mousemove");e("body").css("cursor","auto");s-=parseInt(u/i);o=u%i;if(u<0&&o<-i/2){s++}if(u>0&&o>i/2){s--}if(s<0){s=0}if(s>=r.itemCount){s=r.itemCount-1}n.timeline("goTo",r.items.eq(s).attr("data-id"),r.items.eq(s).attr("data-count"))},open:function(t,n){var r=this,i=r.data("timeline"),s=r.find(i.options.itemOpenClass),o=i.options.scrollSpeed,u=i.itemOpenWidth,a=i.options.easin,f=i.options.itemMargin;s.each(function(){if(e(this).attr("data-id")==t){console.log("opening more: "+t+": this id: "+e(this).attr("data-id"));if(e(".nTimeImg").length>0)e(".nTimeImg").each(function(){e(this).remove()});var s=e(this).find("img");var l=u/11*8;var c="/timthumb.php?src="+s.attr("originalSrc")+"&h="+l+"&w="+u+"&zc=2";s.hide();var h=e(document.createElement("img"));h.attr("src",c);h.addClass("nTimeImg");h.insertAfter(s);if(!n||n==e(this).attr("data-count")){var p=e(this);r.trigger("itemOpen.Timeline");e(this).stop(true).show().animate({width:u,marginLeft:f/2,marginRight:f/2},o,a);if(typeof e(this).attr("data-access")!="undefined"&&e(this).attr("data-access")!=""){var d=e(this).attr("data-access");e.post(d,function(t){e("body").append('<div class="ajax_preloading_holder" style="display:none"></div>');e(".ajax_preloading_holder").html(t);if(e(".ajax_preloading_holder img").length>0){e(".ajax_preloading_holder img").load(function(){p.find(".item_open_content").html(t);e(".ajax_preloading_holder").remove();e(this).attr("data-access","")})}else{p.find(".item_open_content").html(t);e(".ajax_preloading_holder").remove();e(this).attr("data-access","")}})}if(e("body").width()<767){i.margin-=(i.itemWidth+i.options.itemMargin)/2;i.marginResponse=true}else{i.marginResponse=false}i.margin-=(u+i.options.itemMargin+i.itemWidth)/2-i.itemWidth/2;i.iholder.stop(true).animate({marginLeft:i.margin},o,a);i.open=t}}});return r},close:function(t,n,r){var i=this,s=i.data("timeline"),o=i.find(s.options.itemOpenClass),u=s.options.scrollSpeed,a=s.itemOpenWidth,f=s.options.easing;o.each(function(){if(e(this).attr("data-id")==t&&e(this).is(":visible")){i.trigger("itemClose.Timeline");e(this).stop(true).animate({width:0,margin:0},u,f,function(){e(this).hide()});if(s.marginResponse){s.margin+=(s.itemWidth+s.options.itemMargin)/2}s.margin+=(a+s.options.itemMargin)/2;s.iholder.stop(true).animate({marginLeft:s.margin},u,f);s.open=false}});if(n){i.timeline("open",n,r)}return i},right:function(){var e=this,t=e.data("timeline"),n=t.options.scrollSpeed,r=t.options.easing;if(t.currentIndex<t.itemCount-1){var i=t.items.eq(t.currentIndex+1).attr("data-id");var s=t.items.eq(t.currentIndex+1).attr("data-count");e.timeline("goTo",i,s)}else{t.iholder.stop(true).animate({marginLeft:t.margin-50},n/2,r).animate({marginLeft:t.margin},n/2,r)}return e},left:function(){var e=this,t=e.data("timeline"),n=t.options.scrollSpeed,r=t.options.easing;if(t.currentIndex>0){var i=t.items.eq(t.currentIndex-1).attr("data-id");var s=t.items.eq(t.currentIndex-1).attr("data-count");e.timeline("goTo",i,s)}else{t.iholder.stop(true).animate({marginLeft:t.margin+50},n/2,r).animate({marginLeft:t.margin},n/2,r)}return e},goTo:function(t,n,r){if(typeof t!=="undefined"){var i=this,s=i.data("timeline"),o=s.options.scrollSpeed,u=s.options.easing,a=s.items,f=i.find(".timeline_line").width(),l=-1,c=false;a.each(function(r){if(t==e(this).attr("data-id")){console.log("id found "+t);if(!n||n==e(this).attr("data-count")){c=true;l=r;return false}}});if(c){var h=i.find(".t_line_node");h.removeClass("active");var p=h.parent().parent().find('[href="#'+t+'"]').addClass("active");s.lineMargin=-parseInt(p.parent().parent().attr("data-id"),10)*100;if(i.find(".t_line_view:first").width()>i.find(".timeline_line").width()){s.lineMargin*=2;if(p.parent().hasClass("right"))s.lineMargin-=100}if(s.noAnimation){s.noAnimation=false;i.find(".t_line_wrapper").stop(true).css({marginLeft:s.lineMargin+"%"})}else{i.find(".t_line_wrapper").stop(true).animate({marginLeft:s.lineMargin+"%"},o,u)}if(s.open){i.timeline("close",s.open,t,n)}else if(r){i.timeline("open",t,n)}i.trigger("scrollStart.Timeline");s.margin+=(s.itemWidth+s.options.itemMargin)*(s.currentIndex-l);s.currentIndex=l;var d=(parseInt(s.iholder.css("margin-left"))-s.margin)/s.itemWidth;s.iholder.stop(true).animate({marginLeft:s.margin},o+o/5*(Math.abs(d)-1),u,function(){i.trigger("scrollStop.Timeline")})}return i}},lineLeft:function(){var e=this,t=e.data("timeline"),n=t.options.scrollSpeed,r=t.options.easing;if(t.lineMargin!=0&&t.options.categories){t.lineMargin+=100;e.find(".t_line_wrapper").stop(true).animate({marginLeft:t.lineMargin+"%"},n,r)}},lineRight:function(){var e=this,t=e.data("timeline"),n=t.options.scrollSpeed,r=t.options.easing;if(e.find(".t_line_view:first").width()>e.find(".timeline_line").width())var i=t.lineViewCount*2;else var i=t.lineViewCount;if(t.lineMargin!=-(i-1)*100&&t.options.categories){t.lineMargin-=100;e.find(".t_line_wrapper").stop(true).animate({marginLeft:t.lineMargin+"%"},n,r)}},createElements:function(){var t=this,n=t.data("timeline"),r=n.items;var i="\n"+'    <div class="timeline_line" style="text-align: left; position:relative; margin-left:auto; margin-right:auto;">\n'+"	 </div>\n";t.prepend(i);var s=t.find(".timeline_line").width(),o=0,u=new Array,a=[""].concat(n.options.categories);monthsDays=[0].concat(n.options.nuberOfSegments),minM=a.length,minY=99999,maxM=0,maxY=0;if(!n.options.yearsOn)maxY=99999;r.each(function(){var t=e(this).attr("data-id");var r=new Date;var i=r.getDate();var s=r.getMonth()+1;var f=r.getFullYear();if(typeof t==="undefined")t=i+"/"+s+"/"+f+" 0:0:0";if(t=="undefined")t=i+"/"+s+"/"+f+" 0:0:0";if(t=="")t=i+"/"+s+"/"+f+" 0:0:0";var l=t,c=e(this).attr("data-name"),h=e(this).attr("data-description"),p=l.split("/"),d=parseInt(p[0],10),v=e.inArray(p[1],a)!=-1?e.inArray(p[1],a):parseInt(p[1],10),m=p[2].split(" "),g=m[1].split(":"),y=parseInt(g[0]),b=parseInt(g[1]),w=parseInt(g[2]),E=parseInt(m[0],10);maxY=Math.max(maxY,E);maxM=Math.max(maxM,v);minY=Math.min(minY,E);minM=Math.min(minM,v);var S=d/(n.options.categories?monthsDays[v]:monthsDays[1])*100;var x=100/(n.options.categories?monthsDays[v]:monthsDays[1]);var T=x/24;var N=T/60;var C=N/60;var k=S-x;if(y!=0)k=k+T*y;if(b!=0)k=k+N*b;if(w!=0)k=k+C*w;var L=k;u[l]='<a href="#'+l+'" class="t_line_node'+(o==n.currentIndex?" active":"")+'" style="left: '+L+'%; position:absolute; text-align:center;">'+(typeof c!="undefined"?c:d);if(typeof h!="undefined")u[l]+='<span class="t_node_desc" style="white-space:nowrap; position:absolute; z-index: 1;">'+h+"</span>";u[l]+="</a>\n";o++});i="\n"+'		<div id="t_line_left" style="position: absolute;"></div><div id="t_line_right" style="position: absolute;"></div>\n'+'		<div class="t_line_holder" style="position:relative; overflow: hidden; width:100%;">\n'+'			<div class="t_line_wrapper" style="white-space:nowrap;">\n';o=0;if(maxM>0){if(minM%2==0)minM--;if(maxM%2==0){if(maxM>=12){maxM=1;maxY++}else maxM++}else{maxM+=2;if(maxM>=13){maxM=1;maxY++}}if(!n.options.categories){i+='<div class="t_line_view" data-id="'+o+'" style="position:relative; display:inline-block; width:100%;">\n'+'					<div class="t_line_m" style="width:100%; border:0; position:absolute; top:0;">\n';for(var f in u){i+=u[f]}i+="</div>\n"+"</div>"}else{var l=true;while(minY!=maxY&&!isNaN(minY)&&!isNaN(maxY)||minM!=maxM){var c=new Array;var h=0;for(f in u){var p=f.split("/");if(p[1]!=""){m=e.inArray(p[1],a)!=-1?e.inArray(p[1],a):parseInt(p[1],10);if(!n.options.yearsOn)y=minY;else y=parseInt(p[2],10);if(m==minM&&(y==minY||!n.options.yearsOn)){c[f]=u[f];h++;u.splice(f,1)}}}if(h!=0){if(l){l=!l;i+='<div class="t_line_view" data-id="'+o+'" style="position:relative; display:inline-block;">\n'+'					<div class="t_line_m" style="position:absolute; top:0;">\n'+'						<h4 class="t_line_month" style="position:abolute; width:100% top:0; text-align:center;">'+a[minM]+(n.options.yearsOn?'<span class="t_line_month_year"> '+(minY<0?-minY+" B.C.":minY)+"</span>":"")+"</h4>\n";for(f in c){i+=c[f]}i+="					</div> <!-- KRAJ PRVOG -->\n"}else{l=!l;i+='					<div class="t_line_m right" style="position:absolute; top:0;">\n'+'						<h4 class="t_line_month" style="position:abolute; width:100% top:0; text-align:center;">'+(typeof a[minM]!=="undefined"?a[minM]:"")+(n.options.yearsOn?'<span class="t_line_month_year"> '+minY+"</span>":"")+"</h4>\n";for(f in c){i+=c[f]}i+="					</div><!-- KRAJ DRUGOG -->\n"+'					<div style="clear:both"></div>\n'+"				</div>";o++}}if(minM==a.length-1){minM=1;minY++}else{minM++}if(minM==maxM&&!n.options.yearsOn)break}if(!l){i+='					<div class="t_line_m right" style="position:absolute; top:0;">\n'+'						<h4 class="t_line_month" style="position:abolute; width:100% top:0; text-align:center;">'+(typeof a[minM]!=="undefined"?a[minM]:"")+(n.options.yearsOn?'<span class="t_line_month_year"> '+minY+"</span>":"")+"</h4>\n"+"					</div>\n"+'					<div style="clear:both"></div>\n'+"				</div>";o++}}}i+="\n"+'				<div style="clear:both"></div>\n'+"			</div>\n"+"		</div>\n";n.lineViewCount=o;t.find(".timeline_line").html(i);t.find(".t_line_node").each(function(){var i=e(this);e(this).find("span").hide();e(this).hover(function(){r.each(function(){if(e(this).attr("data-id")==i.attr("href").substr(1)){e(this).addClass("item_node_hover")}});e(this).find("span").show()},function(){e(this).find("span").hide();e(".item_node_hover").removeClass("item_node_hover")});if(e(this).hasClass("active")){n.lineMargin=-parseInt(e(this).parent().parent(".t_line_view").attr("data-id"),10)*100;t.find(".t_line_wrapper").css("margin-left",n.lineMargin+"%")}e(this).click(function(n){n.preventDefault();t.find(".t_line_node").removeClass("active");e(this).addClass("active");t.timeline("goTo",e(this).attr("href").substr(1))})});t.find("#t_line_left").click(function(){t.timeline("lineLeft")});t.find("#t_line_right").click(function(){t.timeline("lineRight")})}};e.fn.timeline=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.timeline")}}})(jQuery);$(window).load(function(){connectImage()});$.fn.conRollover=function(e){var t,n;var r,i;$(this).append('\n<div class="image_roll_glass"></div><div class="image_roll_zoom"></div>');switch(e){case"top":t="0";n="0";r="-100%";i="0";break;case"right":t="100%";n="0";r="0";i="0";break;case"bottom":t="0";n="0";r="100%";i="0";break;case"left":t="-100%";n="0";r="0";i="0";break}$(this).find(".image_roll_zoom").css({left:t,top:r});$(this).hover(function(){$(this).find(".image_roll_zoom").stop(true,true).animate({left:n,top:i},200);$(this).find(".image_roll_glass").stop(true,true).fadeIn(200)},function(){$(this).find(".image_roll_zoom").stop(true).animate({left:t,top:r},200);$(this).find(".image_roll_glass").stop(true,true).fadeOut(200)})}(function(){function e(e){var t,n;if(!this.length)return this;t=this[0];t instanceof Document?(n=t,t=n.documentElement):n=t.ownerDocument;if(e==null){if(!n.cancelFullScreen&&!n.webkitCancelFullScreen&&!n.mozCancelFullScreen)return null;return!!n.fullScreen||!!n.webkitIsFullScreen||!!n.mozFullScreen}e?(e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen)&&e.call(t):(e=n.cancelFullScreen||n.webkitCancelFullScreen||n.mozCancelFullScreen)&&e.call(n);return this}jQuery.fn.fullScreen=e;jQuery.fn.toggleFullScreen=function(){return e.call(this,!e.call(this))}})();var _arr_;$(function(){$.ajaxSetup({cache:false});$("body").css({height:$("#iframe_canvas").innerHeight()});$.cookie("storedObj",null);$.cookie("hardcover_book_info_id",null);$(".tab2_content").hide();$(".tab2_content:first").show();$("ul.tabs2 li").live("click",function(){$("ul.tabs2 li").removeClass("active");$(this).addClass("active");$(".tab2_content").hide();var e=$(this).find("a").attr("href");if(e=="#my_home"){$("#my_home").fadeIn();$("#main_inner").append('<div class="ajax_loader"></div>');$.ajax({url:"main/init_fb",type:"post",success:function(t){var n=$.parseJSON(t);$(".ajax_loader").remove();$("#my_home").html(n.data);$(e).fadeIn()}})}else if(e=="#fb_data"){$.cookie("storedObj",null);if($.cookie("hardcover_book_info_id")===null||$.cookie("hardcover_book_info_id")===undefined){$("ul.tabs2 li").removeClass("active");$("#home").addClass("active");$("#main_inner").append('<div class="ajax_loader"></div>');$.ajax({url:"main/init_fb",type:"post",success:function(e){var t=$.parseJSON(e);$(".ajax_loader").remove();$("#my_home").html(t.data);$("#my_home").fadeIn()}})}else{$("#main_inner").append('<div class="ajax_loader"></div>');$.ajax({cache:false,url:"filter/filter_page",type:"post",success:function(t){var n=$.parseJSON(t);$(".ajax_loader").remove();if($("#main_inner").find("#my_album").length==0)$("#main_inner").append("<div class='tab2_content' id='my_album'></div>");$("#main_inner .tab2_content").html("");$("#main_inner").find("#my_album").html(n.data).css("display","block");$(e).fadeIn()}})}}else if(e=="#my_edit"){if($.cookie("hardcover_book_info_id")===null||$.cookie("hardcover_book_info_id")===undefined){$("ul.tabs2 li").removeClass("active");$("#home").addClass("active");$("#main_inner").append('<div class="ajax_loader"></div>');$.ajax({url:"main/init_fb",type:"post",success:function(e){var t=$.parseJSON(e);$(".ajax_loader").remove();$("#my_home").html(t.data);$("#my_home").fadeIn()}})}else{$("#main_inner").append('<div class="ajax_loader"></div>');$.ajax({url:"main/edit_album",type:"post",success:function(t){var n=$.parseJSON(t);$(".ajax_loader").remove();if($("#main_inner").find("#my_edit").length==0)$("#main_inner").append("<div class='tab2_content' id='my_edit'></div>");$("#main_inner .tab2_content").html("");$("#main_inner").html(n.data).css("display","block");$(e).fadeIn()}})}}else if(e=="#my_cover"){$("#main_inner").append('<div class="ajax_loader"></div>');$.ajax({url:"cover/design",type:"post",success:function(t){var n=$.parseJSON(t);$(".ajax_loader").remove();$("body").prepend('<div id="app_loader"><div id="bar"><span></span></div></div>');if($("#main_inner").find("#my_cover").length==0)$("#main_inner").append("<div class='tab2_content' id='my_cover'></div>");$("#main_inner .tab2_content").html("");$("#main_inner").find("#my_cover").html(n.data).css("display","block");if($.cookie("hardcover_book_info_id")===null||$.cookie("hardcover_book_info_id")===undefined){$("#app_loader").remove();modalMessageBox("No Album Data Found","You still need to select an album or create a new album.");modalPosition();$("#home a").click()}else{$("#app_loader").fadeOut("slow");$(e).css({display:"block"}).fadeIn("slow")}}})}else if(e=="#my_album"){$("#main_inner").append('<div class="ajax_loader"></div>');$.ajax({url:"album/my_album",type:"post",success:function(t){var n=$.parseJSON(t);$(".ajax_loader").remove();if($("#main_inner").find("#my_cover").length==0)$("#main_inner").append("<div class='tab2_content' id='my_cover'></div>");$("#main_inner .tab2_content").html("");$("#main_inner").find("#my_cover").html(n.data).css("display","block");$(e).fadeIn()}})}return false});$("#button_main_next").live("click",function(e){e.preventDefault();$("#app_loader").fadeIn("slow");$.ajax({url:"main/init_fb",type:"post",cache:true,success:function(e){var t=$.parseJSON(e);$(".tabs2").removeClass("hideDiv");$("#my_home").html(t.data);$("#my_home").fadeIn();$("#app_loader").fadeOut("slow");getCookie()}});return false});$("button").animate({opacity:1}).hover(function(){$(this).animate({opacity:.8})},function(){$(this).animate({opacity:1})});$("#cover_next").live("click",function(){var e=$("#my_cover_title").val();$.ajax({cache:false,url:"main/filter_page",type:"post",data:{book_name:e},success:function(e){var t=$.parseJSON(e);$(".tabs2").removeClass("hideDiv");$("ul.tabs2 li").removeClass("active");$("ul.tabs2 li#data").addClass("active").fadeIn();if($("#main_inner").find("#my_cover").length==0)$("#main_inner").append("<div class='tab2_content' id='my_cover'></div>");$("#main_inner .tab2_content").html("");$("#main_inner").find("#my_cover").html(t.data).css("display","block");$("#fb_data").fadeIn()}})});$("#album_for_me_cover").on("click",function(){$("#shared_active").css("display","block");$.ajax({url:"../../../main/home_select_booktype_cover",success:function(e){var t=$.parseJSON(e);if(t.status){$("#main_inner_uploder_pop").html(t.data);$("#my_image").click();getCookie();ch()}},error:function(e,t,n){alert("\n"+t.toUpperCase()+': "Page '+n+'"');$("#app_loader").fadeOut("slow")}});return false});$("#album_for_me_unique").on("click",function(){console.log("album for me clicked");$("#shared_active").css("display","block");$.ajax({url:"/main/home_select_booktype_unique",success:function(e){console.log("loading uploader");var t=$.parseJSON(e);if(t.status){if($("#main_inner").find("#my_edit").length==0)$("#main_inner").append("<div class='tab2_content' id='my_edit'></div>");$("#main_inner .tab2_content").html("");$("#main_inner_uploder_pop").html(t.data).css("display","block");$("#main_inner_overlay").css("display","block");getCookie();ch()}},error:function(e,t,n){alert("\n"+t.toUpperCase()+': "Page '+n+'"');$("#app_loader").fadeOut("slow")}});return false});$("#album_for_me1").on("click",function(){$("#app_loader").fadeIn("slow");$.ajax({url:"../../../main/home_select_booktype",success:function(e){var t=$.parseJSON(e);if(t.status){if($("#main_inner").find("#my_edit").length==0)$("#main_inner").append("<div class='tab2_content' id='my_edit'></div>");$("#main_inner .tab2_content").html("");$("#main_inner").find("#my_edit").html(t.data).css("display","block");getCookie();ch();$("#app_loader").fadeOut("slow")}},error:function(e,t,n){alert("\n"+t.toUpperCase()+': "Page '+n+'"');$("#app_loader").fadeOut("slow")}});return false});$("#album_for_me_share").on("click",function(){$("#app_loader").fadeIn("slow");$.ajax({url:"../../../main/home_select_booktype1",success:function(e){var t=$.parseJSON(e);if(t.status){if($("#main_inner").find("#my_edit").length==0)$("#main_inner").append("<div class='tab2_content' id='my_edit'></div>");$("#main_inner .tab2_content").html("");$("#main_inner").find("#my_edit").html(t.data).css("display","block");getCookie();ch();$("#app_loader").fadeOut("slow")}},error:function(e,t,n){alert("\n"+t.toUpperCase()+': "Page '+n+'"');$("#app_loader").fadeOut("slow")}});return false});$("#album_create_name").live("click",function(){$("#book_name_pop").val("");$(".err_div").html("");$("#create_book_name_popu_clcik").click()});$("#album_for_me").on("click",function(){$("#app_loader").fadeIn("slow");$.ajax({url:"../../../main/home_select_booktype",success:function(e){var t=$.parseJSON(e);if(t.status){$(".tabs2").removeClass("hideDiv");$("ul.tabs2 li").removeClass("active");$("ul.tabs2 li#data").addClass("active").fadeIn();$("#my_home").hide();temp=t.data;$("#app_loader").fadeOut("slow");getCookie();if($("#main_inner").find("#upload_cont").length==0)$("#main_inner").append("<div id='upload_cont' class='tab2_content'></div>");$("#main_inner").find("#upload_cont").css("display","block").html(temp)}},error:function(e,t,n){alert("\n"+t.toUpperCase()+': "Page '+n+'"');$("#app_loader").fadeOut("slow")}});return false});$("#delete img").live("click",function(){var e=$(this).attr("id");$("li#"+e).remove();$("#tooltip").remove();return false});$("#button_kihm").live("click",function(){$.ajax({url:"../../../main/kihm_view",type:"post",cache:true,success:function(e){var t=$.parseJSON(e);$(".tabs2").removeClass("hideDiv");$("#my_home").html(t.data);$("#my_home").fadeIn()}})})});this.tooltip=function(){xOffset=10;yOffset=20;$(".tooltip").hover(function(e){this.t=this.title;this.title="";$("body").append("<p id='tooltip'>"+this.t+"</p>");e.pageX>750?e.pageX=600:e.pageX;$("#tooltip").css("top",e.pageY-xOffset+"px").css("left",e.pageX+yOffset+"px").fadeIn("fast")},function(){this.title=this.t;$("#tooltip").remove()});$(".tooltip").mousemove(function(e){$("#tooltip").css("top",e.pageY-(xOffset+27)+"px").css("left",e.pageX+(yOffset-18)+"px")})};(function(e){e.fn.truncate_comment=function(t){function r(t){t.append(t.data("opts").more_link);t.children(".more").click(function(){e(this).hide();e(this).siblings("span:not(.hidden)").hide().siblings("span.hidden").animate({opacity:"toggle"},1e3)})}function i(e){var t=e.data("opts");var n=e.html();var r=t.substr_len;var i="<span>"+t.ellipses+"</span>";var s=n.substr(r,1);while(r<n.length&&!/\s/.test(s)){r++;s=n.substr(r,1)}var o=n.substring(0,r)+i;var u='<span class="hidden" style="display:none;">'+n.substring(r,n.length)+"</span>";e.html(o+u)}var n=e.extend({},e.fn.truncate_comment.defaults,t);this.each(function(){e(this).data("opts",n);if(e(this).html().length>n.substr_len){i(e(this));r(e(this))}});return this};e.fn.truncate_comment.defaults={substr_len:500,ellipses:"&#8230;"}})(jQuery);(function(e){e.fn.myHover=function(t){var n=e.extend({},e.fn.myHover.defaults,t);var r=e(this);this.each(function(){e(this).live("mouseenter",function(t){var r=e(this).parent().get(0).id;var i=e(this).attr("id");var s=e("#"+r).height();var o=e(this).offset().top;var u=e(this).height();e("#"+r).css({height:s});e("#"+r).append('<div class="edit_img_container"><p>'+n.message+"</p></div>");e(".edit_img_container").animate({bottom:20},n.speed_in)}).live("mouseleave",function(){e(".edit_img_container").animate({bottom:0},n.speed_out,function(){e(".edit_img_container").remove()})}).live("click",function(t){var n=e(this).attr("id");var r=e(this).parent().get(0).id;e.cookie("obj_",null);e.cookie("obj_",r);e.cookie("img_",null);e.cookie("img_",n);e.cookie("imgurl_",null);e.cookie("imgurl_",e("#"+n).attr("src"));var i=e("#"+n);var s=i.width();var o=parseInt(e("#"+n).height())+parseInt(e("#"+n).offset().top)-30;var u=parseInt(e("section.current").offset().left);o>parseInt(e("#book").innerHeight())?o=parseInt(e("#book").offset().top)+(parseInt(e("#book").innerHeight())-100):o;e("#img_editor").fadeOut("fast").css({top:o,left:u}).fadeIn("slow");e("img#"+n).draggable({stop:function(t,n){console.log(e(this).position())},cursor:"move",handle:"img"});e("select#border_option").change(function(){e("select#border_option option:selected").each(function(){if(e(this).attr("value")==0){var t="none"}else{var t=e(this).attr("value")+"px solid #000"}e("div#"+r).css({border:t})})});return false})});return this};e.fn.myHover.defaults={speed_in:200,speed_out:200,message:"Message..."}})(jQuery);(function(e){e.fn.myEditor=function(t){function g(t,n,r){var i=JSON.parse(localStorage.getItem("storageFiles"))||{};storageFilesDate=i.date;if(typeof i.imgObject==="undefined"){t.addEventListener("load",function(){n.width=t.width;n.height=t.height;var s=t.width*.5;var o=t.width*1.5;e("#slide_scale").attr("min",s).attr("max",o).attr("value",t.width);var u=n.width/2;var a=Math.floor(e(p).parent().width()/2-u);e(p).css({"margin-left":a});r.drawImage(t,0,0,t.width,t.height);i.imgObject=n.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(i))}catch(f){console.log("Storage failed: "+f);alert("Please click revert to reload...")}e("#mycanvas").fadeIn("slow");e(".ajax_loader").hide("slow")},false);t.setAttribute("src",t.src)}else{t.setAttribute("src",i.imgObject);t.addEventListener("load",function(){n.width=t.width;n.height=t.height;var s=t.width*.5;var o=Math.floor(t.width*1.5);e("#slide_scale").attr("min",s).attr("max",o).attr("value",t.width);var u=n.width/2;var a=Math.floor(e(p).parent().width()/2-u);r.drawImage(t,0,0,t.width,t.height);i.imgObject=n.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(i));t.setAttribute("src",i.imgObject)}catch(f){console.log("Storage failed: "+f);alert("Please click revert to reload...");e("#edit_img").removeClass("bar")}e("#mycanvas").fadeIn("slow");e(".ajax_loader").hide("slow")},false)}}var n=e.extend({},e.fn.myEditor.defaults,t);var r='<input type="button" value="Blur" id="blur"  style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Contrast" id="contrast"  style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Brightness" id="brightness" style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Saturation" id="saturation" style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Sharpen" id="sharpen" style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Grayscale" id="grayscale" style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Hue" id="hue" style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Invert" id="invert" style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Noise" id="noise" style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Sepia" id="sepia" style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Adjust color" id="rgb" style="float:left; margin:18px 5px 0;"/>';r+='<input type="button" value="Close" id="_closeEffect" style="float:left; margin:18px 5px 0;"/>';var i='<p class="float_left" style="margin:5px;">';i+='<select id="border_option">';i+="<option >Border</option>";i+='<option value="0">None</option>';i+='<option value="1">1px</option>';i+='<option value="2">2px</option>';i+='<option value="3">3px</option>';i+='<option value="4">4px</option>';i+='<option value="5">5px</option>';i+="</select>";i+="</p>";var s='<div style="float:left; margin:18px 5px 0;"><div id="icon_minus" class="float_left"></div>';s+='<div id="slider" class="float_left"><input id="slide_scale" type ="range" min ="0" max="0" step ="10"/></div>';s+='<div id="icon_plus" class="float_left"></div>';s+='<p class="float_left" style="margin:5px;"><span><input type="text" name="percentage" id="percentage" disabled="disabled" value="100%" style="text-align:center;width:40px;"/></span> <span>1:1</span> </p>';s+=i;s+="</div>";s+='<input type="button" value="Effects" id="effects" style="float:left; margin:18px 5px 0;"/>';s+='<input type="button" value="Rotate-L" id="rotate_l" style="float:left; margin:18px 5px 0;"/>';s+='<input type="button" value="Rotate-R" id="rotate_r" style="float:left; margin:18px 5px 0;"/>';s+='<input type="button" value="Crop" id="crop" style="float:left; margin:18px 5px 0;"/>';s+='<input type="button" value="Revert" id="revert" style="float:left; margin:18px 5px 0;"/>';s+='<input type="button" value="Save" id="savecanvas" style="float:left; margin:18px 5px 0;"/>';s+='<input type="button" value="Close" id="xclose" style="float:left; margin:18px 5px 0;"/>';var o=e(this);var u=e(this).find("img");var a='<div id="modal_container" style="box-sizing:border-box;height:auto;">';a+='<a href="#" id="close_modal" class="float_right"><img src="../images/close.png" /></a>';a+='<div id="modal_inner" style="overflow:hidden;"><div id="icons_"><div id="icons_placer" style="overflow: hidden;min-width: 200px;position: absolute;"></div></div><div id="edit_img" style="border:none;display:none;"><div class="ajax_loader"></div><canvas id="mycanvas" style="padding:5px;"></canvas></div></div>';a+="</div>";a+='<div id="modal_bckgrnd"></div>';e("body").prepend(a);e("#modal_bckgrnd").css({width:e("body").width(),height:"1000px",opacity:0,background:"#000"}).animate({opacity:.7},"slow",function(){e("#modal_container").css({width:e("body").width(),height:e("body").height(),opacity:1}).fadeIn("slow",function(){e("#modal_inner").css({margin:"10px auto",width:"80%",height:"auto","box-sizing":"border-box",padding:"10px 10px 20px",background:"#F9F9F9",border:"1px solid #EEE","border-radius":"10px","-moz-border-radius":"10px","-webkit-border-radius":"10px"});e("#edit_img").css({height:"auto","min-height":"500px"}).fadeIn("slow",function(){e("#edit_img img").removeClass("editable").addClass("imgedit");e("#icons_placer").append(s).fadeIn("slow");e("#icons_placer").css({"margin-left":Math.floor(e("#icons_").width()/2-e("#icons_placer").width()/2)})})})});var f=o.attr("src").lastIndexOf("/")+1;var l=o.attr("src").substr(f);var c=o.attr("id");var h=e.trim(c.substr(4,30));var p=document.getElementById("mycanvas");var d=p.getContext("2d");var v;var m=new Image;e.ajax({url:"/main/save_img_file",type:"POST",data:{filename:l,uri_:o.attr("src")},success:function(t){localStorage.clear();v="/uploads/"+t;m.src=v;e("#mycanvas").hide();g(m,p,d)}});e("#rotate_l").live("click",function(){var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.save();d.translate(centerX,centerY);d.rotate(rotate*Math.PI/180);d.drawImage(imgObject,centerX-imgW*(scale/100),centerY-imgH*(scale/100),imgW*(scale/100),imgH*(scale/100));d.restore();t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(s){console.log("Storage failed: "+s);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#border_option").live("change",function(){e(".ajax_loader").fadeIn("slow");var t=e(this).val().substr(0,1);if(!isNaN(t)){var n=JSON.parse(localStorage.getItem("storageFiles"))||{};var r=m;r.setAttribute("src",n.imgObject);r.addEventListener("load",function(){p.width=r.width;p.height=r.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var i=p.width/2;var s=Math.floor(e(p).parent().width()/2-i);d.drawImage(r,0,0,p.width,p.height);var o=e(this).val()/2;d.rect(o,o,r.width,r.height);d.strokeStyle="#000";d.lineWidth=t;d.stroke();n.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(n))}catch(u){console.log("Storage failed: "+u);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)}});e("#slide_scale").live("change",function(){var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=new Image;n.setAttribute("src",t.imgObject);var r=n.width/n.height;var i=e(this).val();var s=Math.floor(e(this).val()/r);var o=Math.round(e(this).val()/n.width*100)+"%";e("#percentage").val(o);n.onload=function(){p.width=i;p.height=s;d.drawImage(n,0,0,p.width,p.height)}});e("#effects").live("click",function(){e("#icons_placer").empty().append(r).fadeIn("slow");e("#icons_placer").css({"margin-left":Math.floor(e("#icons_").width()/2-e("#icons_placer").width()/2)})});e("#_closeEffect").live("click",function(){e("#icons_placer").empty().append(s).fadeIn("slow");e("#icons_placer").css({"margin-left":Math.floor(e("#icons_").width()/2-e("#icons_placer").width()/2)})});e("#revert").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};localStorage.clear();var n=m;n.setAttribute("src",v);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(s){console.log("Storage failed: "+s);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#blur").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new BlurFilter).filter(s,{amount:1});d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#contrast").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new ContrastFilter).filter(s,{amount:.7});d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#brightness").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new BrightnessFilter).filter(s,{amount:.2});d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#saturation").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new SaturationFilter).filter(s,{amount:.5});d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#sharpen").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new SharpenFilter).filter(s);d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#grayscale").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new GrayscaleFilter).filter(s);d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#hue").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new HueFilter).filter(s,{amount:.5});d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#invert").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new InvertFilter).filter(s);d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#noise").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new NoiseFilter).filter(s,{amount:25});d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#sepia").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0,p.width,p.height);var s=d.getImageData(0,0,p.width,p.height);(new SepiaFilter).filter(s,{amount:25});d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#rgb").live("click",function(){e(".ajax_loader").fadeIn("slow");var t=JSON.parse(localStorage.getItem("storageFiles"))||{};var n=m;n.setAttribute("src",t.imgObject);n.addEventListener("load",function(){p.width=n.width;p.height=n.height;d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,p.width,p.height);d.save();var r=p.width/2;var i=Math.floor(e(p).parent().width()/2-r);d.drawImage(n,0,0);var s=d.getImageData(0,0,p.width,p.height);(new RGBAdjustFilter).filter(s,{red:1,green:1,blue:2});d.putImageData(s,0,0);t.imgObject=p.toDataURL("image/jpg");try{localStorage.setItem("storageFiles",JSON.stringify(t))}catch(o){console.log("Storage failed: "+o);alert("Please click revert to reload...")}e(".ajax_loader").hide("slow")},false)});e("#savecanvas").live("click",function(t){t.preventDefault();e(".ajax_loader").show("slow");var n=JSON.parse(localStorage.getItem("storageFiles"))||{};var r;e("#mycanvas").animate({opacity:.3});if(typeof n.imgObject==="undefined"){alert("There is no image to save...");return false}else{e(".ajax_loader").fadeIn("slow");n.imgObject=p.toDataURL("image/jpg");r=n.imgObject;var i=e("#"+c).attr("src");var s=e.cookie("hardcover_book_info_id");var o=e.cookie("hardcover_fbid");var u=c;console.log(h);e.ajax({url:"/main/set_save_edited_photos",type:"post",data:{book_info_id:s,fb_id:o,origin:"fb",origin_id:h,original_url:i,edited_url:"http://dev.hardcover.me/uploads/"+l},success:function(t){var i=document.getElementById(u);i.src="/uploads/"+l;i.addEventListener("load",function(){e("#progressnum").remove();console.log("saved....");e(".ajax_loader").hide("slow");e("#mycanvas").animate({opacity:1});try{localStorage.setItem("storageFiles",JSON.stringify(n))}catch(t){console.log("Storage failed: "+t);alert("Please click revert to reload...")}},false);var s=new XMLHttpRequest;s.upload.addEventListener("progress",function(e){},false);s.upload.addEventListener("load",function(e){},false);s.upload.addEventListener("error",function(e){alert("There was an error attempting to upload the file.")},false);s.upload.addEventListener("abort",function(e){alert("The upload has been canceled by the user or the browser dropped the connection.")},false);console.log("saving...");s.open("POST","/main/save_canvas_file?filename="+l,false);s.setRequestHeader("Content-Type","application/upload");s.send(r)}})}return false});e("#close_modal, #xclose").live("click",function(){localStorage.clear();e("#modal_bckgrnd,#modal_container").animate({opacity:0},"slow","linear",function(){e(this).remove()});return false});return this}})(jQuery);$("#cancel").live("click",function(){$("#modal_bckgrnd,#modal_container").animate({opacity:0},"slow","linear",function(){$(this).remove()});return false});$.fn.extend({makeRequest:function(e){$.ajax({url:e._url,type:"POST",cache:false,dataType:"json",data:e.postParam,beforeSend:function(){},error:e.onErrorFn,success:e.onSuccessFn,complete:function(){}})}});(function(e){e.fn.myModal=function(t){var n="";t=e.trim(t).replace(/\s */gi,"");this.each(function(){n='<div id="modal_container"'+(t.length>0?' class="'+t.toLowerCase()+'"':"")+">\n&nbsp;";n+='<div id="modal_inner" style="overflow:hidden"></div>\n</div>\n';n+='<div id="modal_bckgrnd">';n+="</div>";e("body").prepend(n);e("#modal_container").css({width:e(window).width(),height:e(window).height()});e("#modal_bckgrnd").css({width:e(window).width(),height:e(window).height()});e("#modal_bckgrnd").css({opacity:1}).animate({opacity:.7},"slow",function(){e("#cancel").on("click",function(){e("#modal_container, #modal_bckgrnd").animate({opacity:0},"slow","linear",function(){e(this).remove()});return false})})});return this}})(jQuery);$("a").animate({opacity:1}).hover(function(){$(this).animate({opacity:.5})},function(){$(this).animate({opacity:1})});jQuery.fn.pagination=function(e,t){t=jQuery.extend({items_per_page:10,num_display_entries:10,current_page:0,num_edge_entries:0,link_to:"#",prev_text:"Prev",next_text:"Next",ellipse_text:"...",prev_show_always:true,next_show_always:true,callback:function(){return false}},t||{});return this.each(function(){function n(){return Math.ceil(e/t.items_per_page)}function r(){var e=Math.ceil(t.num_display_entries/2);var r=n();var i=r-t.num_display_entries;var s=o>e?Math.max(Math.min(o-e,i),0):0;var u=o>e?Math.min(o+e,r):Math.min(t.num_display_entries,r);return[s,u]}function i(e,n){o=e;cpage=e;s();var r=t.callback(e,u);if(!r){if(n.stopPropagation){n.stopPropagation()}else{n.cancelBubble=true}}return r}function s(){u.empty();var e=r();o=cpage;var s=n();var a=function(e){return function(t){return i(e,t)}};var f=function(e,n){e=e<0?0:e<s?e:s-1;n=jQuery.extend({text:e+1,classes:""},n||{});var r="";if(e==o){r=jQuery("<a class='active'>"+n.text+"</a>").bind("click",a(e)).attr("href",t.link_to.replace(/__id__/,e))}else{r=jQuery("<a>"+n.text+"</a>").bind("click",a(e)).attr("href",t.link_to.replace(/__id__/,e))}if(n.classes){r.addClass(n.classes)}u.append(r)};var l=function(e,n,r){e=e<0?0:e<s?e:s-1;r=jQuery.extend({text:e+1,classes:""},r||{});var i="";if(e==o){i=jQuery("<a class='pag active'>["+n+" - "+(n+1)+"]</a>").bind("click",a(e)).attr("href",t.link_to.replace(/__id__/,e))}else{i=jQuery("<a class='pag'>["+n+" - "+(n+1)+"]</a>").bind("click",a(e)).attr("href",t.link_to.replace(/__id__/,e))}if(r.classes){i.addClass(r.classes)}u.append(i)};if(t.prev_text&&(o>0||t.prev_show_always)){f(o-1,{text:t.prev_text,classes:"prev"})}if(e[0]>0&&t.num_edge_entries>0){var c=Math.min(t.num_edge_entries,e[0]);for(var h=0;h<c;h++){f(h)}if(t.num_edge_entries<e[0]&&t.ellipse_text){jQuery("<span>"+t.ellipse_text+"</span>").appendTo(u)}}for(var h=e[0],p=1;h<e[1];h++,p+=2){l(h,p)}if(e[1]<s&&t.num_edge_entries>0){if(s-t.num_edge_entries>e[1]&&t.ellipse_text){jQuery("<span>"+t.ellipse_text+"</span>").appendTo(u)}var d=Math.max(s-t.num_edge_entries,e[1]);for(var h=d;h<s;h++){f(h)}}if(t.next_text&&(o<s-1||t.next_show_always)){f(o+1,{text:t.next_text,classes:"next"})}}var o=t.current_page;e=!e||e<0?1:e;t.items_per_page=!t.items_per_page||t.items_per_page<0?1:t.items_per_page;var u=jQuery(this);this.selectPage=function(e){i(e)};this.prevPage=function(){if(o>0){i(o-1);return true}else{return false}};this.nextPage=function(){if(o<n()-1){i(o+1);return true}else{return false}};s();t.callback(o,this)})};$(function(){function e(e){jQuery("#js-content-appoval-yes").attr("checked","checked");$(".js-content-approval").show()}function t(){jQuery("#js-content-appoval-no").attr("checked","checked");FB.init({appId:"331059976950036",xfbml:true,cookie:true});FB.ui({method:"apprequests",display:"popup",message:"Hard Cover Request",title:"HardCover group album request"},o)}function n(){var e=$("#js-some-frnd").attr("u_url");FB.init({appId:"331059976950036",xfbml:true,cookie:true});FB.ui({method:"apprequests",display:"popup",data:e,message:"Hard Cover Request",title:"HardCover group album request"},u)}function r(){FB.api("/me",function(e){$("#username").html("<img src='https://graph.facebook.com/"+e.id+"/picture'/><div>"+e.name+"</div>");$("#js-jfmfs-container").jfmfs({max_selected:15,max_selected_message:"{0} of {1} selected",friend_fields:"id,name,last_name",sorter:function(e,t){var n=e.last_name.toLowerCase();var r=t.last_name.toLowerCase();return n<r?-1:n>r?1:0}});$("#js-jfmfs-container").live("jfmfs.friendload.finished",function(){window.console&&console.log("finished loading!")});$("#js-jfmfs-container").live("jfmfs.selection.changed",function(e,t){window.console&&console.log("changed",t)});$("#logged-out-status").fadeOut().hide();$("#js-show-friends").fadeIn().show();$("#js-back-to-settings").fadeIn().show();$("#js-show-friends").css("margin-bottom","10px");$("#js-jfmfs-container").fadeIn().show();$("#js-preview-tab").fadeOut().hide()})}function i(){FB.init({appId:"331059976950036",xfbml:true,cookie:true});FB.ui({method:"stream.publish",message:"Message here.",attachment:{picture:"http://fbrell.com/f8.jpg",name:"HardCover dev",caption:"Caption Testing.",description:"description here",href:"https://dev.hardcover.me"},action_links:[{text:"Code",href:"https://dev.hardcover.me"}],user_prompt_message:"Personal message here"},function(e){if(e&&e.post_id){alert("Post published.")}else{alert("Post not published.")}})}function s(e){$("#js-share-facebook").val(e["post_id"])}function o(e){$("#js-user-data").val(e.to);var t=$.cookie("hardcover_book_info_id");$.each(e.to,function(e,n){$.ajax({url:"/edit_album/save_wall_friends",type:"post",data:"book_info_id="+t+"&friend_fb_id="+n,success:function(e){}})})}function u(e){$("#js-user-data-see").val(e.to);var t=$.cookie("hardcover_book_info_id");$.each(e.to,function(e,n){$.ajax({url:"/edit_album/save_wall_friends",type:"post",data:"book_info_id="+t+"&friend_fb_id="+n,success:function(e){}})})}function a(){$("#js-every").fadeIn().hide();$("#js-content-approval").fadeIn().hide()}function f(){$("#js-every").fadeIn().show();$("#js-content-approval").fadeIn().show()}function l(e){}function c(e){}function h(){$.prettyPhoto.close();return false}$(".js-collab-show").on("click",function(){f()});$(".js-collab-hide").on("click",function(){a()});$("#js-back-to-settings").on("click",function(){$("#logged-out-status").fadeOut().hide();$("#js-show-friends").fadeIn().hide();$("#js-back-to-settings").fadeIn().hide();$("#js-jfmfs-container").fadeIn().hide();$("#js-preview-tab").fadeOut().show()});$(".js-select-friends").on("click",function(){$("#js-back-to-settings").show();$("#js-show-friends").show();r()});$("#js-closepreview").on("click",function(){window.close()})})